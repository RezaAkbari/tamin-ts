{"attachment":[{"file_content":"ew0KICAicmVxdWlyZXMiIDogWw0KICAgICJQdWJsaWNfRnJvbVdvcmsubHVhIiAsDQogICAgIkRhdGVfRnJvbVdvcmsubHVhIiAsDQogICAgIkRhdGFiYXNlX0Zyb21Xb3JrLmx1YSINCiAgXSwNCg0KICAiYm90X25hbWUiOiAic3RhdHVzX3RvZG9fc3RlcF9ib3R5IiwNCg0KICAibGFuZ3VhZ2VzIiA6IHsNCiAgICAiZmEiOiB7DQogICAgICAiX21zZ19mYWxzZV9zdGF0dXMiIDogItmI2LbYuduM2Kog2YXYsdit2YTZhyDZiNin2KjYs9i32Ycg2LrbjNixINqp2KfZhdmEINmF24wg2KjYp9i02K8iICwNCiAgICAgICJfbXNnX3RydWVfc3RhdHVzIiA6ICLZiNi22LnbjNiqINmF2LHYrdmE2Ycg2YjYp9io2LPYt9mHICDaqdin2YXZhCDZhduMINio2KfYtNivIiAsDQogICAgICAiX21zZ19udWxsX3N0YXR1cyIgOiAi2YXYsdit2YTZhyDZiNin2KjYs9iq2Ycg2KfbjCDbjNin2YHYqiDZhti02K8iIA0KICAgIH0sDQogICAgImVuIjogew0KICAgICAgIl9tc2dfZmFsc2Vfc3RhdHVzIjogIlRoZSBzdGF0dXMgb2YgdGhlIGNvbm5lY3RlZCBzdGFnZSBpcyBub3QgY29tcGxldGUiLA0KICAgICAgIl9tc2dfdHJ1ZV9zdGF0dXMiOiAiVGhlIHN0YXR1cyBvZiB0aGUgY29ubmVjdGVkIHN0ZXAgaXMgY29tcGxldGUiICwNCiAgICAgICJfbXNnX251bGxfc3RhdHVzIjogIkRlcGVuZGVudCBzdGFnZSBub3QgZm91bmQiDQogICAgfQ0KICB9DQoNCn0=","mime":"application/json","name":"config.json"},{"file_content":"V0lUSA0KICAgIHRvZG9EYXRhIGFzICgNCiAgICAgICAgd2l0aA0KICAgICAgICAgICAgdG9kbyBhcyAoDQogICAgICAgICAgICAgICAgc2VsZWN0IGlkIGFzIHRhc2tfaWQgLCBUQVNLX1RJVExFICwgV09SS19GTE9XX0lEDQogICAgICAgICAgICAgICAgZnJvbSB0b2RvX3Rhc2sNCiAgICAgICAgICAgICAgICB7e3doZXJlVGFza319DQogICAgICAgICAgICApLA0KICAgICAgICAgICAgdG9kb19zdGVwcyBhcyAoDQogICAgICAgICAgICAgICAgc2VsZWN0IHQuKiAsDQogICAgICAgICAgICAgICAgICAgICAgIHR0cy5pZCByZWFsX3N0ZXAgLCAgdHRzLlNURVBfSUQgYXMgU1RFUF9JRDEgLCB0dHMuU1RBVFVTICwgdHRzLmlkIGFzIHN0ZXBfaWRfcmVhbA0KICAgICAgICAgICAgICAgIGZyb20gdG9kb190YXNrX3N0ZXBzIGFzIHR0cw0KICAgICAgICAgICAgICAgIGpvaW4gdG9kbyBhcyB0IG9uIHQudGFza19pZCA9IHR0cy5UQVNLX0lEIGFuZCB0dHMuV09SS19GTE9XX0lEID0gdC5XT1JLX0ZMT1dfSUQNCiAgICAgICAgICAgICAgICB7e3doZXJlVGFza1N0ZXB9fQ0KICAgICAgICAgICAgKQ0KICAgICAgICBzZWxlY3QgKiBmcm9tICB0b2RvX3N0ZXBzDQogICAgKSAsDQogICAgIHdvcmtmbG93RGF0YSBhcyAoDQogICAgICAgICB3aXRoDQogICAgICAgICAgICAgd3Jva2Zsb3cgYXMgKA0KICAgICAgICAgICAgICAgICBzZWxlY3QgdGQudGFza19pZCwgdGQuVEFTS19USVRMRSAsIHJlYWxfc3RlcCAsIFNURVBfSUQxICwNCiAgICAgICAgICAgICAgICAgICAgICAgIHR3LmlkIGFzIHdvcmtmbG93X2lkICwgdHcuV0ZfVElUTEUgYXMgd29ya2Zsb3dfdGl0bGUNCiAgICAgICAgICAgICAgICAgZnJvbSB0b2RvX3dvcmtmbG93IGFzIHR3DQogICAgICAgICAgICAgICAgIGpvaW4gdG9kb0RhdGEgYXMgdGQgb24gdHcuSUQgPSB0ZC5XT1JLX0ZMT1dfSUQNCiAgICAgICAgICAgICApLA0KICAgICAgICAgICAgIHdvcmtmbG93X3N0ZXBzIGFzICgNCiAgICAgICAgICAgICAgICAgc2VsZWN0IGRpc3RpbmN0IHcuKiAsDQogICAgICAgICAgICAgICAgICAgICAgICB0cy5pZCBhcyBzdGVwX3JlZl9pZCAsIHRzLlNUQVRVUyBhcyBzdGVwX3JlZl9zdGF0dXMgLCB0cy5TVEVQX05BTUUgYXMgc3RlcF9yZWZfbmFtZQ0KICAgICAgICAgICAgICAgICBmcm9tIHRvZG9fc3RlcCBhcyB0cw0KICAgICAgICAgICAgICAgICBqb2luIHdyb2tmbG93IGFzIHcgb24gdy53b3JrZmxvd19pZCA9IHRzLldGX0lEIGFuZCB0cy5pZCA9IHcuU1RFUF9JRDENCiAgICAgICAgICAgICApLA0KICAgICAgICAgICAgIHJlbHMgYXMgKA0KICAgICAgICAgICAgICAgICBzZWxlY3Qgd3MuKiAsIHR3ci5TVEVQX0lEMg0KICAgICAgICAgICAgICAgICBmcm9tIHdvcmtmbG93X3N0ZXBzIGFzIHdzDQogICAgICAgICAgICAgICAgIGpvaW4gdG9kb193b3JrZmxvd19yZWxhdGlvbiBhcyB0d3Igb24gd3Muc3RlcF9yZWZfaWQgPSB0d3IuU1RFUF9JRDENCiAgICAgICAgICAgICApDQogICAgICAgICBzZWxlY3QgZGlzdGluY3QgKiBmcm9tIHJlbHMNCiAgICAgKSAsDQogICAgIG5leHRTdGVwIGFzICgNCiAgICAgICAgIHNlbGVjdCB3ZC5yZWFsX3N0ZXAsDQogICAgICAgICAgICAgICAgd2QudGFza19pZCAsIHdkLlRBU0tfVElUTEUgLCB3ZC53b3JrZmxvd19pZCAsIHdkLndvcmtmbG93X3RpdGxlICwNCiAgICAgICAgICAgICAgICB3ZC5zdGVwX3JlZl9pZCAgLCAgd2Quc3RlcF9yZWZfbmFtZSAgLCBzdGVwX3JlZl9zdGF0dXMgLA0KICAgICAgICAgICAgICAgIHR0cy5TVEVQX0lEIGFzIHN0ZXBfcmVsX2lkICwgdHRzLlNUQVRVUyBhcyBzdGVwX3JlbF9zdGF0dXMNCiAgICAgICAgIGZyb20gdG9kb190YXNrX3N0ZXBzIGFzIHR0cw0KICAgICAgICAgam9pbiB3b3JrZmxvd0RhdGEgYXMgd2Qgb24gd2QuU1RFUF9JRDIgPSB0dHMuU1RFUF9JRCBhbmQgd2QudGFza19pZCA9IHR0cy5UQVNLX0lEIGFuZCB0dHMuV09SS19GTE9XX0lEID0gd2Qud29ya2Zsb3dfaWQNCiAgICAgKQ0Kc2VsZWN0IHt7c2VsZWN0fX0NCiBmcm9tIG5leHRTdGVwDQoNCg==","mime":"text/plain","name":"query_get_data_step.txt"},{"file_content":"LS1QdWJsaWNfRnJvbVdvcmsubHVhDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQotLSAgVE9PTFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpsb2NhbCBfVE9LRU5fRVhQSVJFX0RFRkFVTFQgPSA1Ow0KLS0tDQpmdW5jdGlvbiBzcGl0KHN0cikNCiAgICBsb2NhbCBzdHJPdXQgPSAiIg0KICAgIGZvciB3b3JkIGluIHN0cjpnbWF0Y2goIiVTKyIpIGRvDQogICAgICAgIHN0ck91dCA9IHN0ck91dCAuLiB3b3JkDQogICAgZW5kDQogICAgcmV0dXJuIHN0ck91dDsNCmVuZA0KLS0tLS0tLS0tLS0tLS0tLQ0KZnVuY3Rpb24gc2xpY2Uoc3RyKQ0KICAgIGxvY2FsIHRhYmxlX2RhdGEgPSB7fQ0KICAgIGZvciB0b2tlbiBpbiBzdHJpbmcuZ21hdGNoKHN0ciwgIihbXnxdKykiKSBkbw0KICAgICAgICB0YWJsZS5pbnNlcnQodGFibGVfZGF0YSwgdG9rZW4pDQogICAgZW5kDQogICAgcmV0dXJuIHRhYmxlX2RhdGENCmVuZA0KLS0tLS0tLS0tLS0tLS0tLQ0KZnVuY3Rpb24gZGQoLi4uKQ0KICAgIGxvY2FsIG1lc3NhZ2UgPSB7Li4ufQ0KICAgIHRlYW15YXIud3JpdGVfcmVzdWx0KCIgPGRpdiBjbGFzcz0nYmctd2FybmluZyByb3VuZGVkIHAtMiBib3JkZXIgYm9yZGVyLWRhcmsnPiA8cCBjbGFzcz0nYmctZGFyayB0ZXh0LXdoaXRlIHRleHQtY2VudGVyJz4gbWVzc2FnZTogPC9wPiIpDQogICAgZm9yIGkgPSAxICwgI21lc3NhZ2UgLCAxICAgZG8NCiAgICAgICAgbG9jYWwgaXRlbU1zZyA9IG1lc3NhZ2VbaV07DQogICAgICAgIGlmIHR5cGUoaXRlbU1zZykgPT0gInRhYmxlIiB0aGVuDQogICAgICAgICAgICB0ZWFteWFyLndyaXRlX3Jlc3VsdChib3RfY29kaW5nLmpzb25Db2RkaW5nKGl0ZW1Nc2cgLCB0cnVlKS4uICIgPC9icj4gIikgOw0KICAgICAgICBlbHNlaWYgdHlwZShpdGVtTXNnKSA9PSAic3RyaW5nIiBvciAgdHlwZShpdGVtTXNnKSA9PSAibnVtYmVyIiAgdGhlbg0KICAgICAgICAgICAgdGVhbXlhci53cml0ZV9yZXN1bHQodG9zdHJpbmcoaXRlbU1zZykgLi4gIiA8L2JyPiAiKQ0KICAgICAgICBlbHNlaWYgdHlwZShpdGVtTXNnKSA9PSAiYm9vbGVhbiIgdGhlbg0KICAgICAgICAgICAgdGVhbXlhci53cml0ZV9yZXN1bHQodG9zdHJpbmcoaXRlbU1zZykgLi4gIiA8L2JyPiAiKQ0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICB0ZWFteWFyLndyaXRlX3Jlc3VsdCgiIDwvZGl2PiIpDQplbmQNCi0tLS0tLS0tLS0tLS0tLS0NCmZ1bmN0aW9uIGV4cGxvZGUoc3RyICwgc2VwICwgY2hlY2tFeGlzdCkNCiAgICBpZiBjaGVja0V4aXN0IH49IG5pbCBhbmQgY2hlY2tFeGlzdCA9PSB0cnVlIHRoZW4NCiAgICAgICAgbG9jYWwgZXhpc3QgPSBzdHJpbmcuZmluZChzdHIgLCBzZXApOw0KICAgICAgICBpZiBleGlzdCB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgcmV0dXJuIHN0cjpnc3ViKHNlcCAsICIiKTsNCiAgICAgICAgZW5kDQogICAgICAgIHJldHVybiBuaWw7DQogICAgZW5kDQogICAgcmV0dXJuIHN0cjpnc3ViKHNlcCAsICIiKTsNCmVuZA0KZnVuY3Rpb24gZXhwbG9kZVRvQXJyYXkgKGlucHV0c3RyLCBzZXApDQogICAgaWYgc2VwID09IG5pbCB0aGVuDQogICAgICAgIHNlcCA9ICIlcyINCiAgICBlbmQNCiAgICBsb2NhbCB0PXt9DQogICAgZm9yIHN0ciBpbiBzdHJpbmcuZ21hdGNoKGlucHV0c3RyLCAiKFteIi4uc2VwLi4iXSspIikgZG8NCiAgICAgICAgdGFibGUuaW5zZXJ0KHQsIHN0cikNCiAgICBlbmQNCiAgICByZXR1cm4gdA0KZW5kDQpmdW5jdGlvbiByZXZlcnNlKHRibCkNCiAgICBsb2NhbCByZXZlcnNlZFRhYmxlID0ge30NCiAgICBsb2NhbCBsZW5ndGggPSAjdGJsDQogICAgZm9yIGksIHYgaW4gaXBhaXJzKHRibCkgZG8NCiAgICAgICAgcmV2ZXJzZWRUYWJsZVtsZW5ndGggLSBpICsgMV0gPSB2DQogICAgZW5kDQogICAgcmV0dXJuIHJldmVyc2VkVGFibGUNCmVuZA0KDQotLS0tLS0tLS0tLS0tLS0tDQpmdW5jdGlvbiBjb21tYV92YWx1ZShhbW91bnQpDQogICAgbG9jYWwgZm9ybWF0dGVkID0gYW1vdW50DQogICAgd2hpbGUgdHJ1ZSBkbw0KICAgICAgICBmb3JtYXR0ZWQsIGsgPSBzdHJpbmcuZ3N1Yihmb3JtYXR0ZWQsICJeKC0/JWQrKSglZCVkJWQpIiwgJyUxLCUyJykNCiAgICAgICAgaWYgKGs9PTApIHRoZW4NCiAgICAgICAgICAgIGJyZWFrDQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBmb3JtYXR0ZWQNCmVuZA0KZnVuY3Rpb24gcm91bmQodmFsLCBkZWNpbWFsKQ0KICAgIGlmIChkZWNpbWFsKSB0aGVuDQogICAgICAgIHJldHVybiBtYXRoLmZsb29yKCAodmFsICogMTBeZGVjaW1hbCkgKyAwLjUpIC8gKDEwXmRlY2ltYWwpDQogICAgZWxzZQ0KICAgICAgICByZXR1cm4gbWF0aC5mbG9vcih2YWwrMC41KQ0KICAgIGVuZA0KZW5kDQpmdW5jdGlvbiByYW5kb20obWluICwgbWF4KQ0KICAgIHJldHVybiBtYXRoLnJhbmRvbShtaW4sIG1heCkNCmVuZA0KZnVuY3Rpb24gZm9ybWF0X251bWJlcihhbW91bnQsIGRlY2ltYWwsIHByZWZpeCwgbmVnX3ByZWZpeCkNCiAgICBsb2NhbCBzdHJfYW1vdW50LCAgZm9ybWF0dGVkLCBmYW1vdW50LCByZW1haW4NCg0KICAgIGRlY2ltYWwgPSBkZWNpbWFsIG9yIDINCiAgICBuZWdfcHJlZml4ID0gbmVnX3ByZWZpeCBvciAiLSINCg0KICAgIGZhbW91bnQgPSBtYXRoLmFicyhyb3VuZChhbW91bnQsZGVjaW1hbCkpDQogICAgZmFtb3VudCA9IG1hdGguZmxvb3IoZmFtb3VudCkNCg0KICAgIHJlbWFpbiA9IHJvdW5kKG1hdGguYWJzKGFtb3VudCkgLSBmYW1vdW50LCBkZWNpbWFsKQ0KDQogICAgZm9ybWF0dGVkID0gY29tbWFfdmFsdWUoZmFtb3VudCkNCg0KICAgIGlmIChkZWNpbWFsID4gMCkgdGhlbg0KICAgICAgICByZW1haW4gPSBzdHJpbmcuc3ViKHRvc3RyaW5nKHJlbWFpbiksMykNCiAgICAgICAgZm9ybWF0dGVkID0gZm9ybWF0dGVkIC4uICIuIiAuLiByZW1haW4gLi4NCiAgICAgICAgICAgICAgICBzdHJpbmcucmVwKCIwIiwgZGVjaW1hbCAtIHN0cmluZy5sZW4ocmVtYWluKSkNCiAgICBlbmQNCg0KICAgIGZvcm1hdHRlZCA9IChwcmVmaXggb3IgIiIpIC4uIGZvcm1hdHRlZA0KDQogICAgaWYgKGFtb3VudDwwKSB0aGVuDQogICAgICAgIGlmIChuZWdfcHJlZml4PT0iKCkiKSB0aGVuDQogICAgICAgICAgICBmb3JtYXR0ZWQgPSAiKCIuLmZvcm1hdHRlZCAuLiIpIg0KICAgICAgICBlbHNlDQogICAgICAgICAgICBmb3JtYXR0ZWQgPSBuZWdfcHJlZml4IC4uIGZvcm1hdHRlZA0KICAgICAgICBlbmQNCiAgICBlbmQNCg0KICAgIHJldHVybiBmb3JtYXR0ZWQNCmVuZA0KDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tICBGVU5DVElPTnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCmZ1bmN0aW9ucyA9IHt9Ow0KZnVuY3Rpb24gZnVuY3Rpb25zOmluaXQoYXJyYXkpDQogICAgc2VsZi5hcnJheSA9IGFycmF5Ow0KICAgIHNlbGYuZnVuYyA9IHt9Ow0KICAgIHJldHVybiBzZWxmDQplbmQNCmZ1bmN0aW9uIGZ1bmN0aW9uczpnZXRGdW5jdGlvbnMoKQ0KICAgIGZvciBpLHYgaW4gcGFpcnMgKGZ1bmN0aW9ucy5hcnJheSkgZG8NCiAgICAgICAgaWYgdHlwZSh2KSA9PSAiZnVuY3Rpb24iIHRoZW4NCiAgICAgICAgICAgIHRhYmxlLmluc2VydChmdW5jdGlvbnMuZnVuYyAsIGkpDQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBmdW5jdGlvbnMubWVyZ2VGdW5jdGlvbnNUb090aGVyT2JqZWN0KG9iamVjdCkNCg0KICAgIGZvciBuYW1lUmVmICwgZnVuUmVmIGluIHBhaXJzIChmdW5jdGlvbnMuYXJyYXkpIGRvDQogICAgICAgIGlmIHR5cGUoZnVuUmVmKSA9PSAiZnVuY3Rpb24iICB0aGVuDQoNCiAgICAgICAgICAgIGxvY2FsIG1ldGhvZEV4aXN0ID0gZmFsc2U7DQogICAgICAgICAgICBmb3IgbmFtZVJlbCAsIGZ1blJlbCBpbiBwYWlycyAob2JqZWN0KSBkbw0KICAgICAgICAgICAgICAgIGlmIHR5cGUoZnVuUmVsKSA9PSAiZnVuY3Rpb24iIGFuZCBuYW1lUmVmID09IG5hbWVSZWwgdGhlbg0KICAgICAgICAgICAgICAgICAgICBtZXRob2RFeGlzdCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQoNCiAgICAgICAgICAgIGlmIG1ldGhvZEV4aXN0ID09IGZhbHNlIHRoZW4NCiAgICAgICAgICAgICAgICBvYmplY3RbbmFtZVJlZl0gPSBmdW5SZWY7DQogICAgICAgICAgICBlbmQNCg0KICAgICAgICBlbmQNCiAgICBlbmQNCg0KICAgIHJldHVybiBvYmplY3Q7DQplbmQNCmZ1bmN0aW9uIGZ1bmN0aW9ucy5leGlzdE1ldGhvZChtZXRob2ROYW1lKQ0KICAgIGxvY2FsIGV4aXN0ID0gZmFsc2U7DQogICAgZm9yIGkgPSAxICwgI2Z1bmN0aW9ucy5mdW5jICwgMSAgIGRvDQogICAgICAgIGxvY2FsIGl0ZW1GdW5jID0gZnVuY3Rpb25zLmZ1bmNbaV07DQogICAgICAgIGlmIGl0ZW1GdW5jID09IG1ldGhvZE5hbWUgdGhlbg0KICAgICAgICAgICAgZXhpc3QgPSB0cnVlOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBleGlzdDsNCmVuZA0KZnVuY3Rpb24gZnVuY3Rpb25zLmdldE1ldGhvZChtZXRob2ROYW1lKQ0KICAgIGZvciBpLHYgaW4gcGFpcnMgKGZ1bmN0aW9ucy5hcnJheSkgZG8NCiAgICAgICAgaWYgdHlwZSh2KSA9PSAiZnVuY3Rpb24iIGFuZCBpID09IG1ldGhvZE5hbWUgdGhlbg0KICAgICAgICAgICAgcmV0dXJuIHY7DQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBuaWw7DQplbmQNCg0KDQoNCg0KLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLSBQQVJBTVMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLS0gIFJFQURZIFBBUkFNUyAtLS0tLS0tLS0tLS0tLS0tLQ0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KbGlzdFBhcmFtcyA9IHt9Ow0KZnVuY3Rpb24gZ2V0TGlzdFBhcmFtcygpDQogICAgaWYgI2xpc3RQYXJhbXMgPT0gMCB0aGVuDQogICAgICAgIGxpc3RQYXJhbXMgPSAgdGVhbXlhci5nZXRfaW5wdXQoKTsNCiAgICBlbmQNCiAgICByZXR1cm4gbGlzdFBhcmFtcw0KZW5kDQpmdW5jdGlvbiBnZXRQYXJhbShwYXJhbU5hbWUgLCBjYXN0ICwgZGVmYXVsdCkNCiAgICBsb2NhbCBwYXJhbXMgPSBnZXRMaXN0UGFyYW1zKCk7DQogICAgaWYgcGFyYW1zW3BhcmFtTmFtZV0gfj0gbmlsIHRoZW4NCiAgICAgICAgaWYgY2FzdD09InN0cmluZyIgdGhlbg0KICAgICAgICAgICAgcmV0dXJuIGdldFBhcmFtVG9TdHJpbmcocGFyYW1zICwgcGFyYW1OYW1lICwgZGVmYXVsdCk7DQogICAgICAgIGVsc2VpZiBjYXN0PT0ibnVtYmVyIiB0aGVuDQogICAgICAgICAgICByZXR1cm4gZ2V0UGFyYW1Ub051bWJlcihwYXJhbXMgLCBwYXJhbU5hbWUgLCBkZWZhdWx0KTsNCiAgICAgICAgZWxzZWlmIGNhc3Q9PSJib29sZWFuIiB0aGVuDQogICAgICAgICAgICByZXR1cm4gZ2V0UGFyYW1Ub0Jvb2xlYW4ocGFyYW1zICwgcGFyYW1OYW1lICwgZGVmYXVsdCk7DQogICAgICAgIGVsc2VpZiBjYXN0PT0idGFibGUiIHRoZW4NCiAgICAgICAgICAgIHJldHVybiB0b1RhYmxlKHBhcmFtc1twYXJhbU5hbWVdICwgZGVmYXVsdCk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBwYXJhbXNbcGFyYW1OYW1lXTsNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgaWYgZGVmYXVsdCA9PSBuaWwgdGhlbg0KICAgICAgICByZXR1cm4gbmlsOw0KICAgIGVsc2UNCiAgICAgICAgcmV0dXJuIGRlZmF1bHQ7DQogICAgZW5kDQplbmQNCmZ1bmN0aW9uIHNldFBhcmFtVG9PYmplY3Qob2JqZWN0ICwgcGFyYW1OYW1lICwgY2FzdCAsIGRlZmF1bHQpDQogICAgbG9jYWwgZ2V0UGFyYW0gPSBnZXRQYXJhbShwYXJhbU5hbWUgLCBjYXN0ICwgZGVmYXVsdCk7DQogICAgaWYgZ2V0UGFyYW0gfj0gbmlsIHRoZW4NCiAgICAgICAgb2JqZWN0W3BhcmFtTmFtZV0gPSBnZXRQYXJhbTsNCiAgICBlbmQNCmVuZA0KZnVuY3Rpb24gaXNzZXRLZXkodGFibGUsIGVsZW1lbnQpDQogICAgZm9yIGtleSwgdmFsdWUgaW4gcGFpcnModGFibGUpIGRvDQogICAgICAgIGlmIGtleSA9PSBlbGVtZW50IHRoZW4NCiAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBmYWxzZQ0KZW5kDQpmdW5jdGlvbiBnZXRQYXJhbVRvU3RyaW5nKGFycmF5ICwga2V5ICwgZGVmYXVsdCkNCiAgICBpZiBhcnJheVtrZXldIH49IG5pbCBhbmQgICNhcnJheVtrZXldID4gMCB0aGVuDQogICAgICAgIHJldHVybiB0b3N0cmluZyhhcnJheVtrZXldKTsNCiAgICBlbHNlDQogICAgICAgIGlmIGRlZmF1bHQgPT0gbmlsIHRoZW4NCiAgICAgICAgICAgIHJldHVybiAiIjsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIHRvc3RyaW5nKGRlZmF1bHQpOw0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZA0KZnVuY3Rpb24gZ2V0UGFyYW1Ub051bWJlcihhcnJheSAsIGtleSAsIGRlZmF1bHQpDQogICAgaWYgYXJyYXlba2V5XSB+PSBuaWwgYW5kIHRvbnVtYmVyKGFycmF5W2tleV0pIH49IG5pbCBhbmQgdG9udW1iZXIoYXJyYXlba2V5XSkgPiAwIHRoZW4NCiAgICAgICAgcmV0dXJuIHRvbnVtYmVyKGFycmF5W2tleV0pOw0KICAgIGVsc2UNCiAgICAgICAgaWYgZGVmYXVsdCA9PSBuaWwgdGhlbg0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiB0b251bWJlcihkZWZhdWx0KTsNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQNCmZ1bmN0aW9uIGdldFBhcmFtVG9Cb29sZWFuKGFycmF5ICwga2V5ICwgZGVmYXVsdCkNCg0KICAgIGlmIGFycmF5W2tleV0gfj0gbmlsIHRoZW4NCiAgICAgICAgaWYgdHlwZShhcnJheVtrZXldKSA9PSAibnVtYmVyIiB0aGVuDQogICAgICAgICAgICBpZiBhcnJheVtrZXldID09IDEgdGhlbg0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgZWxzZWlmIGFycmF5W2tleV0gPT0gMCB0aGVuDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVsc2VpZiB0eXBlKGFycmF5W2tleV0pID09ICJzdHJpbmciIHRoZW4NCiAgICAgICAgICAgIGlmIGFycmF5W2tleV0gPT0gIjEiIHRoZW4NCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIGVsc2VpZiBhcnJheVtrZXldID09ICIwIiB0aGVuDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVsc2VpZiB0eXBlKGFycmF5W2tleV0pID09ICJib29sZWFuIiB0aGVuDQogICAgICAgICAgICByZXR1cm4gYXJyYXlba2V5XTsNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgaWYgZGVmYXVsdCA9PSBuaWwgdGhlbg0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgZWxzZQ0KICAgICAgICByZXR1cm4gZGVmYXVsdDsNCiAgICBlbmQNCmVuZA0KZnVuY3Rpb24gdG9UYWJsZShkYXRhICwgZGVmYXVsdCkNCiAgICBpZiB0eXBlKGRhdGEpID09ICJ0YWJsZSIgdGhlbg0KICAgICAgICByZXR1cm4gIGRhdGE7DQogICAgZWxzZWlmIHR5cGUoZGF0YSkgPT0gInN0cmluZyIgdGhlbg0KICAgICAgICByZXR1cm4gc3RyaW5nVG9UYWJsZShkYXRhICwgZGVmYXVsdCk7DQogICAgZW5kDQogICAgaWYgZGVmYXVsdCA9PSBuaWwgdGhlbg0KICAgICAgICByZXR1cm4ge307DQogICAgZWxzZQ0KICAgICAgICByZXR1cm4gZGVmYXVsdDsNCiAgICBlbmQNCmVuZA0KZnVuY3Rpb24gc3RyaW5nVG9UYWJsZShkYXRhU3RyaW5nICwgZGVmYXVsdCkNCiAgICBpZiBwY2FsbChmdW5jdGlvbigpIHJldHVybiAgYm90X2NvZGluZy5qc29uQ29kZGluZyhkYXRhU3RyaW5nICwgZmFsc2UpIGVuZCkgPT0gdHJ1ZSB0aGVuDQogICAgICAgIHJldHVybiBib3RfY29kaW5nLmpzb25Db2RkaW5nKGRhdGFTdHJpbmcgLCBmYWxzZSkNCiAgICBlbmQNCg0KICAgIGlmIGRlZmF1bHQgPT0gbmlsIHRoZW4NCiAgICAgICAgcmV0dXJuIHt9Ow0KICAgIGVsc2UNCiAgICAgICAgcmV0dXJuIHRvVGFibGUoZGVmYXVsdCk7DQogICAgZW5kDQplbmQNCg0KDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tICBBQ0wgUEFSQU1TIC0tLS0tLS0tLS0tLS0tLS0tDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpmdW5jdGlvbiBnZXRQYXJhbUlkSW5TaW5nbGUocGFyYW0pDQogICAgbG9jYWwgcmVzdWx0SWQgPSAwOw0KICAgIGlmIHBhcmFtIH49IG5pbCBhbmQgcGFyYW1bMV0gfj0gbmlsICB0aGVuDQogICAgICAgIGxvY2FsIHJlc0l0ZW0gPSBwYXJhbVsxXTsNCiAgICAgICAgaWYgdHlwZShyZXNJdGVtKSA9PSAidGFibGUiIGFuZCByZXNJdGVtLmlkIH49IG5pbCBhbmQgcmVzSXRlbS5pZD4wIHRoZW4NCiAgICAgICAgICAgIHJlc3VsdElkID0gcmVzSXRlbS5pZDsNCiAgICAgICAgZWxzZWlmIHR5cGUocmVzSXRlbSkgPT0gIm51bWJlciIgdGhlbg0KICAgICAgICAgICAgcmVzdWx0SWQgPSByZXNJdGVtOw0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gdG9zdHJpbmcocmVzdWx0SWQpOw0KZW5kDQpmdW5jdGlvbiBnZXRJZEFjbFNlbGVjdGVkKGxpc3RSZWZlcmVuY2VzICwgaXNGaXJzdCkNCiAgICBpZiBpc0ZpcnN0ID09IGZhbHNlIHRoZW4NCiAgICAgICAgbG9jYWwgbGlzdCA9IHt9Ow0KICAgICAgICBmb3IgeCA9IDEgLCAjbGlzdFJlZmVyZW5jZXMgLCAxICAgZG8NCiAgICAgICAgICAgIGxvY2FsIGl0ZW0gPSBsaXN0UmVmZXJlbmNlc1t4XTsNCiAgICAgICAgICAgIGlmIGl0ZW0uaWQgfj0gbmlsIHRoZW4NCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQobGlzdCAsIGl0ZW0uaWQpOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgICAgICByZXR1cm4gbGlzdDsNCiAgICBlbHNlDQogICAgICAgIHJldHVybiBsaXN0UmVmZXJlbmNlczsNCiAgICBlbmQNCmVuZA0KZnVuY3Rpb24gZ2V0UmVhbEFjbFNlbGVjdGVkKGxpc3RSZWZlcmVuY2VzICwgbGlzdFRvdGFsICwgaXNGaXJzdCkNCiAgICBsaXN0UmVmZXJlbmNlcyA9IGdldElkQWNsU2VsZWN0ZWQobGlzdFJlZmVyZW5jZXMgLCBpc0ZpcnN0KQ0KICAgIGxvY2FsIGxpc3RFeHAgPSB7fTsNCiAgICBmb3IgeCA9IDEgLCAjbGlzdFJlZmVyZW5jZXMgLCAxICAgZG8NCiAgICAgICAgbG9jYWwgaXRlbVJlZklkID0gdG9udW1iZXIobGlzdFJlZmVyZW5jZXNbeF0pOw0KICAgICAgICBsb2NhbCBpdGVtUmVzdWx0ID0gbmlsOw0KICAgICAgICBmb3IgeSA9IDEgLCAjbGlzdFRvdGFsICwgMSAgIGRvDQogICAgICAgICAgICBsb2NhbCBpdGVtID0gbGlzdFRvdGFsW3ldOw0KICAgICAgICAgICAgbG9jYWwgaXRlbUlkID0gMDsNCiAgICAgICAgICAgIGxvY2FsIGl0ZW1OYW1lID0gIiI7DQogICAgICAgICAgICBpZiBpdGVtLmlkIH49IG5pbCB0aGVuDQogICAgICAgICAgICAgICAgaXRlbUlkID0gdG9udW1iZXIoaXRlbS5pZCk7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGlmIGl0ZW0ubmFtZSB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgICAgIGl0ZW1OYW1lID0gaXRlbS5uYW1lOw0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBpZiAoIGl0ZW1OYW1lIH49IG5pbCBhbmQgaXRlbUlkID4gMCkgIGFuZCAoIGl0ZW1OYW1lIH49IG5pbCBhbmQgaXRlbU5hbWUgfj0gIiIpIGFuZCBpdGVtUmVmSWQgPT0gaXRlbUlkIHRoZW4NCiAgICAgICAgICAgICAgICBpdGVtUmVzdWx0ID0gew0KICAgICAgICAgICAgICAgICAgICBpZCA9IGl0ZW1JZCAsDQogICAgICAgICAgICAgICAgICAgIG5hbWUgPSBpdGVtTmFtZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICAgICAgaWYgaXRlbVJlc3VsdCB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGxpc3RFeHAgLCBpdGVtUmVzdWx0KTsNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgcmV0dXJuIGxpc3RFeHA7DQplbmQNCmZ1bmN0aW9uIHNlYXJjaEluQWNsU3RhdGljKGxpc3RBY2wgLCBzZWFyY2gpDQogICAgaWYgc2VhcmNoIH49IG51bGwgYW5kICNzZWFyY2g+MCB0aGVuDQogICAgICAgIGxvY2FsIGxpc3RFeHAgPSB7fTsNCiAgICAgICAgZm9yIHggPSAxICwgI2xpc3RBY2wgLCAxICAgZG8NCiAgICAgICAgICAgIGxvY2FsIGl0ZW1BY2wgPSBsaXN0QWNsW3hdOw0KICAgICAgICAgICAgaWYgIGl0ZW1BY2wubmFtZSB+PSBuaWwgIHRoZW4NCiAgICAgICAgICAgICAgICBpZiBzdHJpbmcuZmluZChpdGVtQWNsLm5hbWUsIHNlYXJjaCkgdGhlbg0KICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQobGlzdEV4cCAsIGl0ZW1BY2wpOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgICAgICByZXR1cm4gbGlzdEV4cDsNCiAgICBlbHNlDQogICAgICAgIHJldHVybiBsaXN0QWNsOw0KICAgIGVuZA0KZW5kDQoNCg0KDQoNCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0gUlVOIEFQSSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCg0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLS0gIFB1YmxpYyBSZXNwb25zZSBSZXF1ZXN0DQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQphcGlSZXNwb25zZSA9IHt9Ow0KZnVuY3Rpb24gYXBpUmVzcG9uc2U6aW5pdCgpDQogICAgc2VsZi5yZXNwb25zZSA9IG5pbDsNCiAgICBzZWxmLnN0YXR1cyA9IGZhbHNlOw0KICAgIHNlbGYuZXJyb3JNZXNzYWdlID0gIiI7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGFwaVJlc3BvbnNlOnNldFJlc3BvbnNlKHJlc3BvbnNlKQ0KICAgIHNlbGYucmVzcG9uc2UgPSByZXNwb25zZTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpUmVzcG9uc2U6c2V0U3RhdHVzKHN0YXR1cykNCiAgICBzZWxmLnN0YXR1cyA9IHN0YXR1czsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpUmVzcG9uc2U6c2V0RXJyb3JNZXNzYWdlKGVycm9yTWVzc2FnZSkNCiAgICBzZWxmLmVycm9yTWVzc2FnZSA9IGVycm9yTWVzc2FnZTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpUmVzcG9uc2UucnVuKCkNCiAgICByZXR1cm4gew0KICAgICAgICByZXNwb25zZSA9IGFwaVJlc3BvbnNlLnJlc3BvbnNlLA0KICAgICAgICBzdGF0dXMgPSBhcGlSZXNwb25zZS5zdGF0dXMsDQogICAgICAgIGVycm9yTWVzc2FnZSA9IGFwaVJlc3BvbnNlLmVycm9yTWVzc2FnZSwNCiAgICB9Ow0KZW5kDQoNCg0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLS0gIENhbGwgQXBpDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpjYWxsQXBpID0ge307DQpmdW5jdGlvbiBjYWxsQXBpOmluaXQoKQ0KICAgIGNhbGxBcGkubW9kdWxlX2lkID0gbmlsOw0KICAgIGNhbGxBcGkucGF0aCA9ICIiOw0KICAgIGNhbGxBcGkucGFyYW1zID0ge307DQogICAgY2FsbEFwaS5vcHRpb25zID0ge307DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGNhbGxBcGk6c2V0TW9kdWxlSWQobW9kdWxlX2lkKQ0KICAgIGNhbGxBcGkubW9kdWxlX2lkID0gbW9kdWxlX2lkOw0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBjYWxsQXBpOnNldFBhdGgocGF0aCkNCiAgICBjYWxsQXBpLnBhdGggPSBwYXRoOw0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBjYWxsQXBpOnNldFBhcmFtcyhwYXJhbXMpDQogICAgY2FsbEFwaS5wYXJhbXMgPSBwYXJhbXM7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGNhbGxBcGk6c2V0T3B0aW9ucyhvcHRpb25zKQ0KICAgIGNhbGxBcGkub3B0aW9ucyA9IG9wdGlvbnM7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGNhbGxBcGk6c2V0VXNlckFwaSh1c2VyQXBpKQ0KICAgIGNhbGxBcGkub3B0aW9uc1sidXNlcl9pZCJdID0gdXNlckFwaTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gY2FsbEFwaS5ydW4oKQ0KICAgIGlmIGNhbGxBcGkubW9kdWxlX2lkIH49IG5pbCBhbmQgY2FsbEFwaS5tb2R1bGVfaWQ+MCB0aGVuDQogICAgICAgIHJldHVybiB0ZWFteWFyLmNhbGxfYXBpKGNhbGxBcGkubW9kdWxlX2lkLCBjYWxsQXBpLnBhdGggLCAgY2FsbEFwaS5wYXJhbXMgLCBjYWxsQXBpLm9wdGlvbnMgKTsNCiAgICBlbmQNCmVuZA0KDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tICBVcmwgQXBpIE91dFNpZGUgW3dpdGggY3VybCBBcGldDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQphcGlDdXJsID0gew0KICAgIGN1cmxDbGFzcyA9IG5pbDsNCn07DQpmdW5jdGlvbiBhcGlDdXJsOmluaXQoKQ0KICAgIGFwaUN1cmwuY3VybENsYXNzID0gbmlsOw0KICAgIGFwaUN1cmwuZG9tYWluID0gIiI7DQogICAgYXBpQ3VybC5wb3J0ID0gNDQzOw0KICAgIGFwaUN1cmwudXJsID0gIiI7DQogICAgYXBpQ3VybC5zZWN1cmUgPSBmYWxzZTsNCiAgICBhcGlDdXJsLnNzbCA9IHRydWU7DQogICAgYXBpQ3VybC5tZXRob2QgPSAiR0VUIjsNCiAgICBhcGlDdXJsLmRhdGEgPSB7IH07DQogICAgYXBpQ3VybC5oZWFkZXIgPSB7DQogICAgICAgIHsgbmFtZSA9ICJBY2NlcHQiICwgdmFsdWU9ICd0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS9hdmlmLGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgsYXBwbGljYXRpb24vc2lnbmVkLWV4Y2hhbmdlO3Y9YjM7cT0wLjcnIH0gLA0KICAgICAgICB7IG5hbWUgPSAiUmVmZXJlciIgLCB2YWx1ZT0gJ2h0dHBzOi8vd3d3LnRlYW15YXIuY29tL2ZhLycgfSAsDQogICAgICAgIHsgbmFtZSA9ICJVc2VyLUFnZW50IiAsIHZhbHVlPSAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzExNC4wLjAuMCBTYWZhcmkvNTM3LjM2JyB9ICwNCiAgICAgICAgeyBuYW1lID0gIktlZXAtQWxpdmUiICwgdmFsdWU9ICd0aW1lb3V0PTYwMCwgbWF4PTEwMDAnIH0gLA0KICAgIH07DQoNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpQ3VybDpzZXREb21haW4oZG9tYWluKQ0KICAgIGFwaUN1cmwuZG9tYWluID0gZG9tYWluOw0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBhcGlDdXJsOnNldFBvcnQocG9ydCkNCiAgICBhcGlDdXJsLnBvcnQgPSBwb3J0Ow0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBhcGlDdXJsOnNldFNvdXJjZShzZWN1cmUpDQogICAgYXBpQ3VybC5zZWN1cmUgPSBzZWN1cmU7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGFwaUN1cmw6c2V0U3NsKHNzbCkNCiAgICBhcGlDdXJsLnNzbCA9IHNzbDsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpQ3VybDpzZXRNZXRob2RQb3N0KCkNCiAgICBhcGlDdXJsLm1ldGhvZCA9ICJQT1NUIjsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpQ3VybDpzZXRNZXRob2RHZXQoKQ0KICAgIGFwaUN1cmwubWV0aG9kID0gIkdFVCI7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGFwaUN1cmw6c2V0VXJsKHVybCkNCiAgICBhcGlDdXJsLnVybCA9IHVybDsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpQ3VybDpzZXREYXRhKGRhdGEpDQogICAgYXBpQ3VybC5kYXRhID0gZGF0YTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpQ3VybDphZGREYXRhKGRhdGFUaXRsZSAsIGRhdGFWYWx1ZSkNCiAgICBhcGlDdXJsLmRhdGFbZGF0YVRpdGxlXSA9IGRhdGFWYWx1ZTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpQ3VybDphZGRIZWFkZXIoaGVhZGVyVGl0bGUgLCBoZWFkZXJWYWx1ZSkNCiAgICB0YWJsZS5pbnNlcnQodXJsQmFzZS5oZWFkZXIgLCB7IG5hbWUgPSBoZWFkZXJUaXRsZSAsIHZhbHVlPSBoZWFkZXJWYWx1ZSB9ICk7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGFwaUN1cmw6YWRkSGVhZGVyQXV0aChhdXRoKQ0KICAgIHRhYmxlLmluc2VydChhcGlDdXJsLmhlYWRlciAsIHsgbmFtZSA9ICJBdXRob3JpemF0aW9uIiAsIHZhbHVlPSAiQmVhcmVyICIgLi5hdXRoIH0gKTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpQ3VybDpzZXRSZWZyZXNoUmVxdWVzdCgpDQogICAgYXBpQ3VybC5kYXRhID0geyB9Ow0KICAgIGFwaUN1cmwuaGVhZGVyID0geyB9Ow0KICAgIGFwaUN1cmwudXJsID0gIiI7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGFwaUN1cmw6c2V0RmluaXNoUmVxdWVzdCgpDQogICAgYXBpQ3VybC5jdXJsQ2xhc3M6ZGlzY29ubmVjdCgpOw0KICAgIGFwaUN1cmwuY3VybENsYXNzOnJlbGVhc2UoKTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYXBpQ3VybC5ydW4oZG9FbmQpDQogICAgbG9jYWwgY29kZSA9IDA7DQogICAgbG9jYWwgc3RhdHVzID0gZmFsc2U7DQogICAgbG9jYWwgcmVzcG9uc2UgPSBuaWw7DQogICAgbG9jYWwgZXJyb3JNZXNzYWdlID0gIiI7DQoNCiAgICBsb2NhbCBpc0Nvbm5lY3Rpb24gPSB0cnVlOw0KICAgIGlmIGFwaUN1cmwuY3VybENsYXNzID09IG5pbCB0aGVuDQogICAgICAgIGFwaUN1cmwuY3VybENsYXNzID0gdGVhbXlhci5jcmVhdGVfY3VybCgpOw0KICAgICAgICBpc0Nvbm5lY3Rpb24gPSBhcGlDdXJsLmN1cmxDbGFzczpjb25uZWN0KHtkb21haW49IGFwaUN1cmwuZG9tYWluICwgcG9ydD1hcGlDdXJsLnBvcnQsIHNzbD1hcGlDdXJsLnNzbCwgc2VjdXJlPWFwaUN1cmwuc2VjdXJlfSk7DQogICAgZW5kDQoNCiAgICBpZiBpc0Nvbm5lY3Rpb24gPT0gdHJ1ZSB0aGVuDQoNCiAgICAgICAgbG9jYWwgcGFyYW1zID0gew0KICAgICAgICAgICAgbWV0aG9kPWFwaUN1cmwubWV0aG9kLA0KICAgICAgICAgICAgdXJsID0gYXBpQ3VybC51cmwsDQogICAgICAgICAgICBoZWFkZXJzPXt9DQogICAgICAgIH07DQogICAgICAgIGZvciB4ID0gMSAsICNhcGlDdXJsLmhlYWRlciAsIDEgICBkbw0KICAgICAgICAgICAgbG9jYWwgaXRlbUhlYWRlciA9IGFwaUN1cmwuaGVhZGVyW3hdOw0KICAgICAgICAgICAgaWYgaXRlbUhlYWRlci5uYW1lIH49IG5pbCBhbmQgaXRlbUhlYWRlci52YWx1ZSB0aGVuDQogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBhcmFtcy5oZWFkZXJzKTsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCg0KICAgICAgICBjb2RlID0gYXBpQ3VybC5jdXJsQ2xhc3M6c2VuZFJlcXVlc3QocGFyYW1zKTsNCiAgICAgICAgc3RhdHVzID0gYXBpQ3VybC5jdXJsQ2xhc3M6Z2V0U3RhdHVzKCk7DQogICAgICAgIHJlc3BvbnNlID0gYXBpQ3VybC5jdXJsQ2xhc3M6Z2V0UmVzcG9uc2UoKTsNCiAgICAgICAgZXJyb3JNZXNzYWdlID0gYXBpQ3VybC5jdXJsQ2xhc3M6Z2V0RXJyb3JNZXNzYWdlKCk7DQoNCiAgICAgICAgaWYgZG9FbmQgfj0gbmlsIGFuZCBkb0VuZCA9PSB0cnVlIHRoZW4NCiAgICAgICAgICAgIGFwaUN1cmw6c2V0RmluaXNoUmVxdWVzdCgpOw0KICAgICAgICBlbmQNCg0KICAgIGVuZA0KDQogICAgcmV0dXJuIGNvZGUgLCBzdGF0dXMgLCByZXNwb25zZSAsIGVycm9yTWVzc2FnZTsNCmVuZA0KDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tICBVcmwgQXBpIE91dFNpZGUgW3dpdGggc2FtcGxlIEFwaV0NCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCnVybEJhc2UgPSB7fTsNCmZ1bmN0aW9uIHVybEJhc2U6aW5pdCgpDQogICAgdXJsQmFzZS5kb21haW4gPSAiIjsNCiAgICB1cmxCYXNlLnBvcnQgPSA0NDM7DQogICAgdXJsQmFzZS51cmwgPSAiIjsNCiAgICB1cmxCYXNlLnNlY3VyZSA9IGZhbHNlOw0KICAgIHVybEJhc2Uuc3NsID0gdHJ1ZTsNCiAgICB1cmxCYXNlLm1ldGhvZCA9ICJHRVQiOw0KICAgIHVybEJhc2UuZGF0YV9zdHIgPSBuaWw7DQogICAgdXJsQmFzZS5kYXRhID0geyB9Ow0KICAgIHVybEJhc2UuaGVhZGVyID0geyB9Ow0KICAgIHVybEJhc2UuZmlsZXMgPSB7IH07DQoNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gdXJsQmFzZTpzZXREb21haW4oZG9tYWluKQ0KICAgIHVybEJhc2UuZG9tYWluID0gZG9tYWluOw0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiB1cmxCYXNlOnNldFBvcnQocG9ydCkNCiAgICB1cmxCYXNlLnBvcnQgPSBwb3J0Ow0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiB1cmxCYXNlOnNldFVybCh1cmwpDQogICAgdXJsQmFzZS51cmwgPSB1cmw7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIHVybEJhc2U6c2V0U291cmNlKHNlY3VyZSkNCiAgICB1cmxCYXNlLnNlY3VyZSA9IHNlY3VyZTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gdXJsQmFzZTpzZXRTc2woc3NsKQ0KICAgIHVybEJhc2Uuc3NsID0gc3NsOw0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiB1cmxCYXNlOnNldE1ldGhvZFBvc3QoKQ0KICAgIHVybEJhc2UubWV0aG9kID0gIlBPU1QiOw0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiB1cmxCYXNlOnNldE1ldGhvZEdldCgpDQogICAgdXJsQmFzZS5tZXRob2QgPSAiR0VUIjsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gdXJsQmFzZTpzZXREYXRhU3RyKGRhdGFfc3RyKQ0KICAgIHVybEJhc2UuZGF0YV9zdHIgPSBkYXRhX3N0cjsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gdXJsQmFzZTphZGREYXRhKGRhdGFUaXRsZSAsIGRhdGFWYWx1ZSkNCiAgICB1cmxCYXNlLmRhdGFbZGF0YVRpdGxlXSA9IGRhdGFWYWx1ZTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gdXJsQmFzZTphZGRIZWFkZXIoaGVhZGVyVGl0bGUgLCBoZWFkZXJWYWx1ZSkNCiAgICB0YWJsZS5pbnNlcnQodXJsQmFzZS5oZWFkZXIgLCB7IG5hbWUgPSBoZWFkZXJUaXRsZSAsIHZhbHVlPSBoZWFkZXJWYWx1ZSB9ICk7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIHVybEJhc2U6YWRkSGVhZGVyQXV0aChhdXRoKQ0KICAgIHRhYmxlLmluc2VydCh1cmxCYXNlLmhlYWRlciAsIHsgbmFtZSA9ICJBdXRob3JpemF0aW9uIiAsIHZhbHVlPSAiQmVhcmVyICIgLi5hdXRoIH0gKTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gdXJsQmFzZTphZGRGaWxlKGZpbGVEYXRhKQ0KICAgIHRhYmxlLmluc2VydCh1cmxCYXNlLmZpbGVzICwgZmlsZURhdGEgKTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gdXJsQmFzZS5ydW4oKQ0KICAgIGxvY2FsIHJlcXVlc3QgPSB7fTsNCiAgICByZXF1ZXN0LmRvbWFpbiA9IHVybEJhc2UuZG9tYWluOw0KICAgIHJlcXVlc3QucG9ydCA9IHVybEJhc2UucG9ydDsNCiAgICByZXF1ZXN0LnVybCA9IHVybEJhc2UudXJsOw0KICAgIHJlcXVlc3Quc2VjdXJlID0gdXJsQmFzZS5zZWN1cmU7DQogICAgcmVxdWVzdC5zc2wgPSB1cmxCYXNlLnNzbDsNCiAgICByZXF1ZXN0Lm1ldGhvZCA9IHVybEJhc2UubWV0aG9kOw0KDQogICAgaWYgdXJsQmFzZS5kYXRhX3N0ciB+PSBuaWwgdGhlbg0KICAgICAgICByZXF1ZXN0LmRhdGFfc3RyID0gdXJsQmFzZS5kYXRhX3N0cjsNCiAgICBlbmQNCiAgICBpZiAjdXJsQmFzZS5kYXRhID4gMCB0aGVuDQogICAgICAgIHJlcXVlc3QuZGF0YSA9IHVybEJhc2UuZGF0YTsNCiAgICBlbmQNCiAgICBpZiAjdXJsQmFzZS5oZWFkZXIgPiAwIHRoZW4NCiAgICAgICAgcmVxdWVzdC5oZWFkZXIgPSB1cmxCYXNlLmhlYWRlcjsNCiAgICBlbmQNCiAgICBpZiAjdXJsQmFzZS5maWxlcyA+IDAgdGhlbg0KICAgICAgICByZXF1ZXN0LmZpbGVzID0gdXJsQmFzZS5maWxlczsNCiAgICBlbmQNCg0KICAgIHRlYW15YXIud3JpdGVfcmVzdWx0KGpzb24uZW5jb2RlKHJlcXVlc3QpLi4iPGJyLz4iKTsNCg0KICAgIGxvY2FsIHJlc3BvbnNlID0gdGVhbXlhci5jYWxsX3VybChyZXF1ZXN0KTsNCiAgICBpZiByZXNwb25zZS5yZXN1bHQgfj0gbmlsIHRoZW4NCiAgICAgICAgbG9jYWwgcmVzdWx0ID0gcmVzcG9uc2UucmVzdWx0Ow0KICAgICAgICBpZiByZXN1bHQuYm9keSB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5ib2R5Ow0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gbmlsOw0KZW5kDQoNCg0KDQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tIEJPVCBVUkxTIFRPT0xTICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQpib3RfdXJsX3Rvb2xzID0ge307DQpmdW5jdGlvbiBib3RfdXJsX3Rvb2xzOmluaXQoKQ0KICAgIHNlbGYuY29uZmlnID0ge307DQoNCiAgICBzZWxmLmJvdF9wcmVmaXhfcGF0aCA9ICIiOw0KICAgIHNlbGYuYm90X25hbWUgPSAiIjsNCiAgICBzZWxmLmJhc2VfdXJsID0gIiI7DQogICAgc2VsZi5ib3RfdXJsID0gIiI7DQogICAgc2VsZi5iYXNlID0gIiI7DQogICAgc2VsZi5saWNlbmNlSWQgPSAiIjsNCg0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBib3RfdXJsX3Rvb2xzOnNldENvbmZpZ0RhdGEoKQ0KICAgIGxvY2FsIGNvbmZpZ0pzb24gPSBfYm94QXR0YWNobWVudC5nZXRBdHRhY2htZW50KCJjb25maWcuanNvbiIgLCB0cnVlKTsNCiAgICBpZiBjb25maWdKc29ufj0gbmlsIHRoZW4NCiAgICAgICAgYm90X3VybF90b29scy5jb25maWcgPSBjb25maWdKc29uOw0KICAgIGVuZA0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBib3RfdXJsX3Rvb2xzOmdldFJlc3VsdEJhc2VMaW5rKCkNCiAgICBsb2NhbCByZXN1bHQgPSB0ZWFteWFyLmdldF9saWNlbnNlX2luZm8oKTsNCiAgICBib3RfdXJsX3Rvb2xzLmxpY2VuY2VJZCA9IHJlc3VsdC5pZDsNCiAgICBib3RfdXJsX3Rvb2xzLmJvdF9wcmVmaXhfcGF0aCA9ICJib3QvcnVuLyIuLnJlc3VsdC5pZC4uIi8iOw0KICAgIGJvdF91cmxfdG9vbHMuYmFzZV91cmwgPSAiaHR0cHM6Ly8iIC4uIHJlc3VsdC5kb21haW4gLi4gIi8iOw0KDQogICAgaWYgYm90X3VybF90b29scy5jb25maWcgfj0gbmlsIHRoZW4NCiAgICAgICAgaWYgYm90X3VybF90b29scy5jb25maWcuYm90X25hbWUgfj0gbmlsIHRoZW4NCiAgICAgICAgICAgIGJvdF91cmxfdG9vbHMuYm90X25hbWUgPSBib3RfdXJsX3Rvb2xzLmNvbmZpZy5ib3RfbmFtZSA7DQogICAgICAgIGVuZA0KDQogICAgICAgIGlmIGJvdF91cmxfdG9vbHMuY29uZmlnLmxpY2VuY2VfaWQgfj0gbmlsIHRoZW4NCiAgICAgICAgICAgIGJvdF91cmxfdG9vbHMubGljZW5jZUlkID0gYm90X3VybF90b29scy5jb25maWcubGljZW5jZV9pZDsNCiAgICAgICAgICAgIGJvdF91cmxfdG9vbHMuYm90X3ByZWZpeF9wYXRoID0gImJvdC9ydW4vIi4uYm90X3VybF90b29scy5jb25maWcubGljZW5jZV9pZC4uIi8iOw0KICAgICAgICBlbmQNCg0KICAgICAgICBpZiBib3RfdXJsX3Rvb2xzLmNvbmZpZy5kb21haW4gfj0gbmlsIHRoZW4NCiAgICAgICAgICAgIGJvdF91cmxfdG9vbHMuYmFzZV91cmwgPSAiaHR0cHM6Ly8iIC4uIGJvdF91cmxfdG9vbHMuY29uZmlnLmRvbWFpbiAuLiAiLyI7DQogICAgICAgIGVuZA0KICAgIGVuZA0KDQogICAgYm90X3VybF90b29scy5ib3RfdXJsID0gYm90X3VybF90b29scy5ib3RfcHJlZml4X3BhdGggLi4gYm90X3VybF90b29scy5ib3RfbmFtZTsNCiAgICAtLXJlcG9ydF9tYWluLmJhc2UgPSByZXBvcnRfbWFpbi5iYXNlX3VybCAuLnJlcG9ydF9tYWluLmJvdF91cmw7DQogICAgYm90X3VybF90b29scy5iYXNlID0gIi8iIC4uYm90X3VybF90b29scy5ib3RfdXJsOw0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBib3RfdXJsX3Rvb2xzLnJ1bigpDQogICAgYm90X3VybF90b29sczppbml0KCk6c2V0Q29uZmlnRGF0YSgpOmdldFJlc3VsdEJhc2VMaW5rKCk7DQoNCiAgICByZXR1cm4gew0KICAgICAgICBib3RfcHJlZml4X3BhdGggPSBib3RfdXJsX3Rvb2xzLmJvdF9wcmVmaXhfcGF0aCwNCiAgICAgICAgYm90X25hbWUgPSBib3RfdXJsX3Rvb2xzLmJvdF9uYW1lLA0KICAgICAgICBiYXNlX3VybCA9IGJvdF91cmxfdG9vbHMuYmFzZV91cmwsDQogICAgICAgIGJvdF91cmwgPSBib3RfdXJsX3Rvb2xzLmJvdF91cmwsDQogICAgICAgIGJhc2UgPSBib3RfdXJsX3Rvb2xzLmJhc2UsDQogICAgICAgIGxpY2VuY2VJZCA9IGJvdF91cmxfdG9vbHMubGljZW5jZUlkLA0KICAgIH0NCmVuZA0KDQoNCg0KDQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tIENPRElORyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQpib3RfY29kaW5nID0ge307DQpmdW5jdGlvbiBib3RfY29kaW5nLmpzb25Db2RkaW5nKGlucHV0ICwgZG9FbmNvZGUpDQogICAgaWYgZG9FbmNvZGUgfj0gbmlsIHRoZW4NCiAgICAgICAgaWYgZG9FbmNvZGUgPT0gdHJ1ZSB0aGVuDQogICAgICAgICAgICByZXR1cm4ganNvbi5lbmNvZGUoaW5wdXQpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4ganNvbi5kZWNvZGUoaW5wdXQpOw0KICAgICAgICBlbmQNCiAgICBlbmQNCg0KICAgIHJldHVybiBqc29uLmVuY29kZShpbnB1dCk7DQplbmQNCmZ1bmN0aW9uIGJvdF9jb2RpbmcuYXNjaWlfdG9fdXRmMTZsZShpbnB1dCkNCiAgICBsb2NhbCB1dGYxNiA9IHt9DQogICAgZm9yIGkgPSAxLCAjaW5wdXQgZG8NCiAgICAgICAgbG9jYWwgY2hhckNvZGUgPSBpbnB1dDpieXRlKGkpDQogICAgICAgIHRhYmxlLmluc2VydCh1dGYxNiwgc3RyaW5nLmNoYXIoY2hhckNvZGUpKQ0KICAgICAgICB0YWJsZS5pbnNlcnQodXRmMTYsIHN0cmluZy5jaGFyKDApKQ0KICAgIGVuZA0KICAgIHJldHVybiB0YWJsZS5jb25jYXQodXRmMTYpDQplbmQNCmZ1bmN0aW9uIGJvdF9jb2RpbmcuaGV4X3RvX2FzY2lpKGhleCkNCiAgICBsb2NhbCByZXN1bHQgPSAiIg0KICAgIGZvciBpID0gMSwgI2hleCwgMiBkbw0KICAgICAgICBsb2NhbCBieXRlID0gdG9udW1iZXIoaGV4OnN1YihpLCBpKzEpLCAxNikNCiAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uIHN0cmluZy5jaGFyKGJ5dGUpDQogICAgZW5kDQogICAgcmV0dXJuIHJlc3VsdA0KZW5kDQpmdW5jdGlvbiBib3RfY29kaW5nLmJpbl90b19oZXgoYmluYXJ5X2RhdGEpDQogICAgbG9jYWwgaGV4X3RhYmxlID0gew0KICAgICAgICAiMCIsICIxIiwgIjIiLCAiMyIsICI0IiwgIjUiLCAiNiIsICI3IiwNCiAgICAgICAgIjgiLCAiOSIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiINCiAgICB9DQoNCiAgICBsb2NhbCBoZXhfc3RyaW5nID0gIiINCiAgICBmb3IgaSA9IDEsICNiaW5hcnlfZGF0YSBkbw0KICAgICAgICBsb2NhbCBieXRlID0gc3RyaW5nLmJ5dGUoYmluYXJ5X2RhdGEsIGkpDQogICAgICAgIGxvY2FsIGZpcnN0X2hhbGYgPSBoZXhfdGFibGVbbWF0aC5mbG9vcihieXRlIC8gMTYpICsgMV0NCiAgICAgICAgbG9jYWwgc2Vjb25kX2hhbGYgPSBoZXhfdGFibGVbKGJ5dGUgJSAxNikgKyAxXQ0KICAgICAgICBoZXhfc3RyaW5nID0gaGV4X3N0cmluZyAuLiBmaXJzdF9oYWxmIC4uIHNlY29uZF9oYWxmDQogICAgZW5kDQoNCiAgICByZXR1cm4gaGV4X3N0cmluZw0KZW5kDQpmdW5jdGlvbiBib3RfY29kaW5nLnJhbmRvbV9ieXRlcyhsZW5ndGgpDQogICAgbG9jYWwgcmFuZG9tX2J5dGVzID0ge30NCiAgICBmb3IgaSA9IDEsIGxlbmd0aCBkbw0KICAgICAgICBsb2NhbCByYW5kb21fYnl0ZSA9IG1hdGgucmFuZG9tKDAsIDI1NSkNCiAgICAgICAgdGFibGUuaW5zZXJ0KHJhbmRvbV9ieXRlcywgc3RyaW5nLmNoYXIocmFuZG9tX2J5dGUpKQ0KICAgIGVuZA0KICAgIHJldHVybiB0YWJsZS5jb25jYXQocmFuZG9tX2J5dGVzKQ0KZW5kDQoNCg0KZnVuY3Rpb24gYm90X2NvZGluZy5zdHJpbmdUb1NoYTEoc3RyKQ0KICAgIHJldHVybiBjb2Rpbmcuc2hhMShzdHIpDQplbmQNCmZ1bmN0aW9uIGJvdF9jb2Rpbmcuc3RyaW5nVG9TaGEyNTYoc3RyKQ0KICAgIHJldHVybiBjb2Rpbmcuc2hhMjU2KHN0cikNCmVuZA0KZnVuY3Rpb24gYm90X2NvZGluZy5zdHJpbmdUb01ENShzdHIpDQogICAgcmV0dXJuIGNvZGluZy5tZDUoc3RyKQ0KZW5kDQoNCg0KDQoNCg0KDQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0gQXV0aCA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQphcGlBdXRoZW50aWNhdGlvbiA9IHt9Ow0KZnVuY3Rpb24gYXBpQXV0aGVudGljYXRpb24uY3JlYXRlVG9rZW5BcGlBdXRvKHRva2VuUGFzc3dvcmQpDQogICAgbG9jYWwgdGltZVVuaXggPSBjb252ZXJ0VGltZVRlYW15YXJUb1RpbWVVbml4KCk7DQogICAgbG9jYWwgY29kaW5nU3RlcE9uZSA9IGJvdF9jb2Rpbmcuc3RyaW5nVG9TaGEyNTYodG9rZW5QYXNzd29yZC4uInx8Ii4udGltZVVuaXgpOw0KICAgIHJldHVybiBjb2RpbmdTdGVwT25lLi4ifHwiLi50aW1lVW5peA0KZW5kDQpmdW5jdGlvbiBhcGlBdXRoZW50aWNhdGlvbi5jcmVhdGVUb2tlbkFwaVdpdGhUaW1lKHRva2VuUGFzc3dvcmQgLCB0aW1lVW5peCkNCiAgICBsb2NhbCBjb2RpbmdTdGVwT25lID0gYm90X2NvZGluZy5zdHJpbmdUb1NoYTI1Nih0b2tlblBhc3N3b3JkLi4ifHwiLi50aW1lVW5peCk7DQogICAgcmV0dXJuIGNvZGluZ1N0ZXBPbmUuLiJ8fCIuLnRpbWVVbml4DQplbmQNCmZ1bmN0aW9uIGFwaUF1dGhlbnRpY2F0aW9uLmNoZWNrVG9rZW5BcGkodG9rZW5QYXNzd29yZCAsIGtleSAsIHRva2VuRXhwaXJlKQ0KICAgIGxvY2FsIHJlc3VsdEV4cCA9IHsNCiAgICAgICAgc3RhdHVzID0gZmFsc2UgLA0KICAgICAgICBjb2RlID0gMA0KICAgIH07DQogICAgaWYga2V5IH49IG5pbCB0aGVuDQogICAgICAgIC0tIGtleSBpcyBub3QgbnVsbCBidXQgbm90IGV4aXN0IGtleSAxJjINCiAgICAgICAgcmVzdWx0RXhwLmNvZGUgPSAxOw0KICAgICAgICBsb2NhbCB0YWJsZVRva2VuID0gZXhwbG9kZVRvQXJyYXkoa2V5ICwgInx8Iik7DQogICAgICAgIGlmIHRhYmxlVG9rZW5bMV0gfj0gbmlsIGFuZCB0YWJsZVRva2VuWzJdIH49IG5pbCB0aGVuDQogICAgICAgICAgICAtLSBleGlzdCBrZXkgMSYyIGJ1dCBrZXlHZXR0ZXIgbm90IG1hdGNoDQogICAgICAgICAgICByZXN1bHRFeHAuY29kZSA9IDI7DQogICAgICAgICAgICBsb2NhbCB0aW1lR2V0dGVyID0gdGFibGVUb2tlblsyXTsNCiAgICAgICAgICAgIGxvY2FsIGtleUhhc2hlZCA9IGFwaUF1dGhlbnRpY2F0aW9uLmNyZWF0ZVRva2VuQXBpV2l0aFRpbWUodG9rZW5QYXNzd29yZCAsIHRpbWVHZXR0ZXIpOw0KICAgICAgICAgICAgaWYga2V5ID09IGtleUhhc2hlZCB0aGVuDQogICAgICAgICAgICAgICAgLS0ga2V5R2V0dGVyIG1hdGNoIGJ1dCB0aW1lR2V0dGVyIGV4cGlyZQ0KICAgICAgICAgICAgICAgIHJlc3VsdEV4cC5jb2RlID0gMzsNCiAgICAgICAgICAgICAgICBsb2NhbCB0aW1lQ3VycmVudFVuaXggPSBjb252ZXJ0VGltZVRlYW15YXJUb1RpbWVVbml4KCk7DQogICAgICAgICAgICAgICAgaWYgdG9rZW5FeHBpcmUgPT0gbmlsIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgdG9rZW5FeHBpcmUgPSBfVE9LRU5fRVhQSVJFX0RFRkFVTFQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBsb2NhbCB0aW1lU3RhcnQgPSB0aW1lR2V0dGVyICsgKHRva2VuRXhwaXJlKjYwKTsNCiAgICAgICAgICAgICAgICBsb2NhbCB0aW1lRXhwaXJlID0gdGltZUN1cnJlbnRVbml4Ow0KICAgICAgICAgICAgICAgIGlmIHRvbnVtYmVyKHRpbWVTdGFydCkgPj0gdG9udW1iZXIodGltZUV4cGlyZSkgIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgLS0gdGltZUdldHRlciBpcyB0cnVlDQogICAgICAgICAgICAgICAgICAgIHJlc3VsdEV4cC5jb2RlID0gNDsNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0RXhwLnN0YXR1cyA9IHRydWU7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgcmV0dXJuIHJlc3VsdEV4cDsNCmVuZA0KDQoNCg0KDQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tIExhbmd1YWdlIHRvb2xzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQpsYW5ndWFnZV90b29scyA9IHt9Ow0KZnVuY3Rpb24gbGFuZ3VhZ2VfdG9vbHM6aW5pdCgpDQogICAgc2VsZi5hbGxMYW5ndWFnZXMgPSB7fTsNCiAgICBzZWxmLmxhbmd1YWdlcyA9IHt9Ow0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBsYW5ndWFnZV90b29sczpzZXRDb25maWdEYXRhKCkNCiAgICBsb2NhbCBjb25maWdKc29uID0gX2JveEF0dGFjaG1lbnQuZ2V0QXR0YWNobWVudCgiY29uZmlnLmpzb24iICwgdHJ1ZSk7DQogICAgaWYgY29uZmlnSnNvbn49IG5pbCB0aGVuDQogICAgICAgIGxhbmd1YWdlX3Rvb2xzLmNvbmZpZyA9IGNvbmZpZ0pzb247DQogICAgZW5kDQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGxhbmd1YWdlX3Rvb2xzOnNldExhbmd1YWdlcygpDQogICAgaWYgbGFuZ3VhZ2VfdG9vbHMuY29uZmlnIH49IG5pbCBhbmQgbGFuZ3VhZ2VfdG9vbHMuY29uZmlnLmxhbmd1YWdlcyB+PSBuaWwgdGhlbg0KICAgICAgICBsYW5ndWFnZV90b29scy5hbGxMYW5ndWFnZXMgPSAgbGFuZ3VhZ2VfdG9vbHMuY29uZmlnLmxhbmd1YWdlczsNCiAgICAgICAgbG9jYWwgbGFuZ3VhZ2UgPSAgdXNlcl9pbmZvLmdldExhbmdUaXRsZSgpOw0KICAgICAgICBpZiBsYW5ndWFnZV90b29scy5hbGxMYW5ndWFnZXNbbGFuZ3VhZ2VdIH49IG5pbCB0aGVuDQogICAgICAgICAgICBsYW5ndWFnZV90b29scy5sYW5ndWFnZXMgPSBsYW5ndWFnZV90b29scy5hbGxMYW5ndWFnZXNbbGFuZ3VhZ2VdOw0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gbGFuZ3VhZ2VfdG9vbHM6cmVhZHlMaWIoKQ0KICAgIGxhbmd1YWdlX3Rvb2xzOmluaXQoKTpzZXRDb25maWdEYXRhKCk6c2V0TGFuZ3VhZ2VzKCk7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCg0KLS0tDQpmdW5jdGlvbiBsYW5ndWFnZV90b29scy50cmFuc2xhdGVUZW1wbGF0ZSh0ZW1wbGF0ZSAsIGN1c3RvbUxhbmd1YWdlcykNCiAgICBsYW5ndWFnZV90b29sczpyZWFkeUxpYigpOw0KICAgIGxvY2FsIGxhbmdzID0gbGFuZ3VhZ2VfdG9vbHMubGFuZ3VhZ2VzOw0KICAgIGlmIGN1c3RvbUxhbmd1YWdlcyB+PSBuaWwgIHRoZW4NCiAgICAgICAgbGFuZ3MgPSBjdXN0b21MYW5ndWFnZXM7DQogICAgZW5kDQogICAgcmV0dXJuIGxhbmd1YWdlX3Rvb2xzLnRyYW5zbGF0ZVRlbXBsYXRlUnVuKHRlbXBsYXRlICwgY3VzdG9tTGFuZ3VhZ2VzICwgbGFuZ3MpDQplbmQNCmZ1bmN0aW9uIGxhbmd1YWdlX3Rvb2xzLnRyYW5zbGF0ZVRlbXBsYXRlT3V0ZXJMaXN0KHRlbXBsYXRlICwgY3VzdG9tTGFuZ3VhZ2VzICwgb3V0ZXJMaXN0KQ0KICAgIHJldHVybiBsYW5ndWFnZV90b29scy50cmFuc2xhdGVUZW1wbGF0ZVJ1bih0ZW1wbGF0ZSAsIGN1c3RvbUxhbmd1YWdlcyAsIG91dGVyTGlzdCkNCmVuZA0KZnVuY3Rpb24gbGFuZ3VhZ2VfdG9vbHMudHJhbnNsYXRlVGVtcGxhdGVSdW4odGVtcGxhdGUgLCBjdXN0b21MYW5ndWFnZXMgLCBsaXN0KQ0KICAgIGlmIHRlbXBsYXRlIH49IG5pbCBhbmQgbGlzdCB+PSBuaWwgdGhlbg0KICAgICAgICBmb3Iga2V5LCB3b3JkIGluIHBhaXJzKGxpc3QpIGRvDQogICAgICAgICAgICB0ZW1wbGF0ZSA9IHN0cmluZy5nc3ViKHRlbXBsYXRlICwgInt7IiAuLmtleS4uICJ9fSIgLCB0b3N0cmluZyh3b3JkKSk7DQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiB0ZW1wbGF0ZTsNCmVuZA0KDQotLS0NCmZ1bmN0aW9uIGxhbmd1YWdlX3Rvb2xzLnRyYW5zbGF0ZVdvcmQoa2V5V29yZCAsIGRlZmF1bHQpDQogICAgbGFuZ3VhZ2VfdG9vbHM6cmVhZHlMaWIoKTsNCiAgICByZXR1cm4gbGFuZ3VhZ2VfdG9vbHMudHJhbnNsYXRlV29yZFJ1bihrZXlXb3JkICwgZGVmYXVsdCAsIGxhbmd1YWdlX3Rvb2xzLmxhbmd1YWdlcykNCmVuZA0KZnVuY3Rpb24gbGFuZ3VhZ2VfdG9vbHMudHJhbnNsYXRlV29yZE91dGVyTGlzdChrZXlXb3JkICwgZGVmYXVsdCAsIG91dGVyTGlzdCkNCiAgICByZXR1cm4gbGFuZ3VhZ2VfdG9vbHMudHJhbnNsYXRlV29yZFJ1bihrZXlXb3JkICwgZGVmYXVsdCAsIG91dGVyTGlzdCkNCmVuZA0KZnVuY3Rpb24gbGFuZ3VhZ2VfdG9vbHMudHJhbnNsYXRlV29yZFJ1bihrZXlXb3JkICwgZGVmYXVsdCAsIGxpc3QpDQogICAgbGFuZ3VhZ2VfdG9vbHM6cmVhZHlMaWIoKTsNCiAgICBpZiBrZXlXb3JkIH49IG5pbCB0aGVuDQogICAgICAgIGZvciBrZXksIHdvcmQgaW4gcGFpcnMobGlzdCkgZG8NCiAgICAgICAgICAgIGlmIGtleSA9PSBrZXlXb3JkIHRoZW4NCiAgICAgICAgICAgICAgICByZXR1cm4gd29yZDsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gZGVmYXVsdDsNCmVuZA0KDQotLS0NCmZ1bmN0aW9uIGxhbmd1YWdlX3Rvb2xzLnRyYW5zbGF0ZVdvcmRJbkxhbmd1YWdlU2VsZWN0ZWQoa2V5V29yZCAsIGxhbmcsIGRlZmF1bHQpDQogICAgbGFuZ3VhZ2VfdG9vbHM6cmVhZHlMaWIoKTsNCiAgICBpZiBrZXlXb3JkIH49IG5pbCBhbmQgbGFuZ3VhZ2VfdG9vbHMuYWxsTGFuZ3VhZ2VzIH49IG5pbCBhbmQgbGFuZ3VhZ2VfdG9vbHMuYWxsTGFuZ3VhZ2VzW2xhbmddIH49IG5pbCB0aGVuDQogICAgICAgIGZvciBrZXksIHdvcmQgaW4gcGFpcnMobGFuZ3VhZ2VfdG9vbHMuYWxsTGFuZ3VhZ2VzW2xhbmddKSBkbw0KICAgICAgICAgICAgaWYga2V5ID09IGtleVdvcmQgdGhlbg0KICAgICAgICAgICAgICAgIHJldHVybiB3b3JkOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBkZWZhdWx0Ow0KZW5kDQoNCg0KDQoNCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0gVVNFUiBJTkZPID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCnVzZXJfaW5mbyA9IHsNCiAgICB1c2VySW5mbyA9IG5pbDsNCn07DQpmdW5jdGlvbiB1c2VyX2luZm8uZ2V0VXNlckluZm8oKQ0KICAgIGlmIHVzZXJfaW5mby51c2VySW5mbyA9PSBuaWwgdGhlbg0KICAgICAgICB1c2VyX2luZm8udXNlckluZm8gPSB0ZWFteWFyLmdldF91c2VyX2luZm8oKTsNCiAgICBlbmQNCmVuZA0KZnVuY3Rpb24gdXNlcl9pbmZvLnVzZXJJZCgpDQogICAgdXNlcl9pbmZvLmdldFVzZXJJbmZvKCk7DQogICAgaWYgdXNlcl9pbmZvLnVzZXJJbmZvIH49IG5pbCBhbmQgIHVzZXJfaW5mby51c2VySW5mby5pZCB+PSBuaWwgdGhlbg0KICAgICAgICByZXR1cm4gdXNlcl9pbmZvLnVzZXJJbmZvLmlkOw0KICAgIGVuZA0KICAgIHJldHVybiAwOw0KZW5kDQpmdW5jdGlvbiB1c2VyX2luZm8udXNlckdlbmRlcigpDQogICAgdXNlcl9pbmZvLmdldFVzZXJJbmZvKCk7DQogICAgaWYgdXNlcl9pbmZvLnVzZXJJbmZvIH49IG5pbCBhbmQgIHVzZXJfaW5mby51c2VySW5mby5nZW5kZXIgfj0gbmlsIHRoZW4NCiAgICAgICAgcmV0dXJuIHVzZXJfaW5mby51c2VySW5mby5nZW5kZXI7DQogICAgZW5kDQogICAgcmV0dXJuIDE7DQplbmQNCmZ1bmN0aW9uIHVzZXJfaW5mby51c2VyTmFtZSgpDQogICAgdXNlcl9pbmZvLmdldFVzZXJJbmZvKCk7DQogICAgaWYgdXNlcl9pbmZvLnVzZXJJbmZvIH49IG5pbCBhbmQgIHVzZXJfaW5mby51c2VySW5mby5uYW1lIH49IG5pbCB0aGVuDQogICAgICAgIHJldHVybiB1c2VyX2luZm8udXNlckluZm8ubmFtZTsNCiAgICBlbmQNCiAgICByZXR1cm4gIiI7DQplbmQNCmZ1bmN0aW9uIHVzZXJfaW5mby51c2VyRmFtaWx5KCkNCiAgICB1c2VyX2luZm8uZ2V0VXNlckluZm8oKTsNCiAgICBpZiB1c2VyX2luZm8udXNlckluZm8gfj0gbmlsIGFuZCAgdXNlcl9pbmZvLnVzZXJJbmZvLmZhbWlseSB+PSBuaWwgdGhlbg0KICAgICAgICByZXR1cm4gdXNlcl9pbmZvLnVzZXJJbmZvLmZhbWlseTsNCiAgICBlbmQNCiAgICByZXR1cm4gIiI7DQplbmQNCmZ1bmN0aW9uIHVzZXJfaW5mby51c2VyRnVsbE5hbWUoKQ0KICAgIHVzZXJfaW5mby5nZXRVc2VySW5mbygpOw0KICAgIGlmIHVzZXJfaW5mby51c2VySW5mbyB+PSBuaWwgYW5kICB1c2VyX2luZm8udXNlckluZm8ubmFtZSB+PSBuaWwgYW5kIHVzZXJfaW5mby51c2VySW5mby5mYW1pbHkgfj0gbmlsIHRoZW4NCiAgICAgICAgcmV0dXJuIHVzZXJfaW5mby51c2VySW5mby5uYW1lIC4uICIgIiAuLiB1c2VyX2luZm8udXNlckluZm8uZmFtaWx5Ow0KICAgIGVuZA0KICAgIHJldHVybiAiIjsNCmVuZA0KZnVuY3Rpb24gdXNlcl9pbmZvLnVzZXJUaW1lWm9uZSgpDQogICAgdXNlcl9pbmZvLmdldFVzZXJJbmZvKCk7DQogICAgaWYgdXNlcl9pbmZvLnVzZXJJbmZvIH49IG5pbCBhbmQgIHVzZXJfaW5mby51c2VySW5mby50aW1lem9uZSB+PSBuaWwgdGhlbg0KICAgICAgICByZXR1cm4gdXNlcl9pbmZvLnVzZXJJbmZvLnRpbWV6b25lOw0KICAgIGVuZA0KICAgIHJldHVybiAwOw0KZW5kDQpmdW5jdGlvbiB1c2VyX2luZm8udXNlckxhbmdJZCgpDQogICAgdXNlcl9pbmZvLmdldFVzZXJJbmZvKCk7DQogICAgaWYgdXNlcl9pbmZvLnVzZXJJbmZvIH49IG5pbCBhbmQgIHVzZXJfaW5mby51c2VySW5mby5sYW5nX2lkIH49IG5pbCB0aGVuDQogICAgICAgIHJldHVybiB1c2VyX2luZm8udXNlckluZm8ubGFuZ19pZDsNCiAgICBlbmQNCiAgICByZXR1cm4gNDsNCmVuZA0KZnVuY3Rpb24gdXNlcl9pbmZvLnVzZXJJc0xhbmd1YWdlRmEoKQ0KICAgIGxvY2FsIGxhbmdfaWQgPSB1c2VyX2luZm8udXNlckxhbmdJZCgpOw0KICAgIGlmIGxhbmdfaWQgPT0gNCB0aGVuDQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIGVuZA0KICAgIHJldHVybiBmYWxzZTsNCmVuZA0KZnVuY3Rpb24gdXNlcl9pbmZvLmdldExhbmdUaXRsZSgpDQogICAgbG9jYWwgaXNQZXJzaWFuID0gdXNlcl9pbmZvLnVzZXJJc0xhbmd1YWdlRmEoKTsNCiAgICBpZiBpc1BlcnNpYW4gPT0gdHJ1ZSB0aGVuDQogICAgICAgIHJldHVybiAiZmEiOw0KICAgIGVuZA0KICAgIHJldHVybiAiZW4iOw0KZW5k","mime":"text/plain","name":"Public_FromWork.lua"},{"file_content":"LS1EYXRlX0Zyb21Xb3JrLmx1YQ0KDQpsb2NhbCBfVElNRV9URUFNWUFSX1VOSVQgPSAxMDAwMDAwMDsNCmxvY2FsIF9USU1FX1RFQU1ZQVJfRElGID0gMS4xNjQ0NzIzZSsxNzsNCmxvY2FsIF9USU1FX1RFQU1ZQVJfTUlEID0gMTE2NDQ0NzM2MDA7DQoNCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0gREFURSBDQUxDVUxBVE9SID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCmZ1bmN0aW9uIHN0YXJ0WWVhcigpDQogICAgbG9jYWwgdGhpc1llYXIgPSBnZXRUaGlzWWVhcigpOw0KICAgIGxvY2FsIHRpbWVTaGFtY2kgPSB7DQogICAgICAgIHllYXIgPSB0aGlzWWVhciAsDQogICAgICAgIG1vbnRoID0gMSAsDQogICAgICAgIGRheSA9IDENCiAgICB9DQogICAgdGltZVNoYW1jaSA9IHRpbWUudG9fZ3JpZ29yaWFuKHRpbWVTaGFtY2kpOw0KICAgIGxvY2FsIHRpbWVNaWxhZGkgPSB7DQogICAgICAgIHllYXIgPSAgdGltZVNoYW1jaS55ZWFyICwNCiAgICAgICAgbW9udGggPSB0aW1lU2hhbWNpLm1vbnRoICwNCiAgICAgICAgZGF5ID0gdGltZVNoYW1jaS5kYXkgLA0KICAgICAgICBob3VyID0gMSwNCiAgICAgICAgbWludXRlID0gMSAsDQogICAgICAgIHNlY29uZCA9IDENCiAgICB9Ow0KICAgIHJldHVybiB0aW1lLmdldF9maWxldGltZShqc29uLmVuY29kZSh0aW1lTWlsYWRpKSk7DQplbmQNCmZ1bmN0aW9uIGdldFRoaXNZZWFyKCkNCiAgICBsb2NhbCB0aGlzWWVhciA9IHRpbWUuZ2V0X3llYXIodGltZS5jdXJyZW50KCkpOw0KICAgIGxvY2FsIHRoaXNNb250aCA9IHRpbWUuZ2V0X21vbnRoKHRpbWUuY3VycmVudCgpKTsNCiAgICBsb2NhbCB0aGlzRGF5ID0gdGltZS5nZXRfZGF5KHRpbWUuY3VycmVudCgpKQ0KICAgIGxvY2FsIGRhdGEgPXsNCiAgICAgICAgeWVhciA9IHRoaXNZZWFyICwNCiAgICAgICAgbW9udGggPSB0aGlzTW9udGggLA0KICAgICAgICBkYXkgPSB0aGlzRGF5ICwNCiAgICB9DQogICAgbG9jYWwgdGltZVNoYW1zaSA9IHRpbWUudG9famFsYWxpKGRhdGEpOw0KICAgIGlmIHRpbWVTaGFtc2kueWVhciB+PSBuaWwgdGhlbg0KICAgICAgICB0aGlzWWVhciA9IHRpbWVTaGFtc2kueWVhcjsNCiAgICBlbHNlDQogICAgICAgIHRoaXNZZWFyID0gMTQwMjsNCiAgICBlbmQNCiAgICByZXR1cm4gdGhpc1llYXI7DQplbmQNCmZ1bmN0aW9uIGdldEN1cnJlbnRUaW1lKCkNCiAgICByZXR1cm4gdGltZS5jdXJyZW50KCk7DQplbmQNCmZ1bmN0aW9uIGdldENhbGNMYXN0VGltZUZyb21DdXJyZW50VGltZSh0aW1lKQ0KICAgIHJldHVybiBnZXRDdXJyZW50VGltZSgpIC0gdGltZSpfVElNRV9URUFNWUFSX1VOSVQ7DQplbmQNCmZ1bmN0aW9uIGdldENhbGNOZXh0VGltZUZyb21DdXJyZW50VGltZSh0aW1lKQ0KICAgIHJldHVybiBnZXRDdXJyZW50VGltZSgpICsgdGltZSpfVElNRV9URUFNWUFSX1VOSVQ7DQplbmQNCmZ1bmN0aW9uIHNldERhdGVUb1RlYW15YXJGb3JtYXQoZGF0ZVRtICAsIGR1cmF0aW9uKQ0KICAgIGlmIGR1cmF0aW9uID09IG5pbCB0aGVuDQogICAgICAgIGR1cmF0aW9uID0gMDsNCiAgICBlbmQNCiAgICByZXR1cm4gZGF0ZVRtICsgZHVyYXRpb24qNjAqNjAqMjQqX1RJTUVfVEVBTVlBUl9VTklUOw0KZW5kDQoNCmZ1bmN0aW9uIHN0YXJ0WWVhcigpDQoNCiAgICAtLSBnZXQgdGhpcyB5ZWFyDQogICAgbG9jYWwgdGhpc1llYXIgPSBnZXRUaGlzWWVhcigpOw0KDQogICAgLS0gZ2V0IGxhc3QgZGF5IHllYXIgZ3JpZ29yaWFuDQogICAgbG9jYWwgdGltZVNoYW1jaSA9IHsNCiAgICAgICAgeWVhciA9IHRoaXNZZWFyICwNCiAgICAgICAgbW9udGggPSAxICwNCiAgICAgICAgZGF5ID0gMQ0KICAgIH0NCg0KICAgIHRpbWVTaGFtY2kgPSB0aW1lLnRvX2dyaWdvcmlhbih0aW1lU2hhbWNpKTsNCg0KICAgIC0tIGdldCB0aW1lc3RhbXAgZGF5DQogICAgbG9jYWwgdGltZU1pbGFkaSA9IHsNCiAgICAgICAgeWVhciA9ICB0aW1lU2hhbWNpLnllYXIgLA0KICAgICAgICBtb250aCA9IHRpbWVTaGFtY2kubW9udGggLA0KICAgICAgICBkYXkgPSB0aW1lU2hhbWNpLmRheSAsDQogICAgICAgIGhvdXIgPSAxLA0KICAgICAgICBtaW51dGUgPSAxICwNCiAgICAgICAgc2Vjb25kID0gMQ0KICAgIH07DQoNCiAgICByZXR1cm4gdGltZS5nZXRfZmlsZXRpbWUoanNvbi5lbmNvZGUodGltZU1pbGFkaSkpOw0KZW5kDQpmdW5jdGlvbiBmaW5pc2hZZWFyKCkNCg0KICAgIC0tIGdldCB0aGlzIHllYXINCiAgICBsb2NhbCB0aGlzWWVhciA9IGdldFRoaXNZZWFyKCk7DQoNCiAgICAtLSBnZXQgbGFzdCBkYXkgeWVhciBncmlnb3JpYW4NCiAgICBsb2NhbCB0aW1lU2hhbWNpID0gew0KICAgICAgICB5ZWFyID0gdGhpc1llYXIgLA0KICAgICAgICBtb250aCA9IDEyICwNCiAgICAgICAgZGF5ID0gMjkNCiAgICB9DQoNCiAgICB0aW1lU2hhbWNpID0ganNvbi5kZWNvZGUodGltZS50b19ncmlnb3JpYW4oanNvbi5lbmNvZGUodGltZVNoYW1jaSkpKTsNCg0KICAgIC0tIGdldCB0aW1lc3RhbXAgZGF5DQogICAgbG9jYWwgdGltZU1pbGFkaSA9IHsNCiAgICAgICAgeWVhciA9ICB0aW1lU2hhbWNpLnllYXIgLA0KICAgICAgICBtb250aCA9IHRpbWVTaGFtY2kubW9udGggLA0KICAgICAgICBkYXkgPSB0aW1lU2hhbWNpLmRheSAsDQogICAgICAgIGhvdXIgPSAxLA0KICAgICAgICBtaW51dGUgPSAxICwNCiAgICAgICAgc2Vjb25kID0gMQ0KICAgIH07DQoNCiAgICByZXR1cm4gIHRpbWUuZ2V0X2ZpbGV0aW1lKGpzb24uZW5jb2RlKHRpbWVNaWxhZGkpKTsNCmVuZA0KZnVuY3Rpb24gZ2V0VGhpc1llYXIoKQ0KICAgIGxvY2FsIHRoaXNZZWFyID0gdGltZS5nZXRfeWVhcih0aW1lLmN1cnJlbnQoKSk7DQogICAgbG9jYWwgdGhpc01vbnRoID0gdGltZS5nZXRfbW9udGgodGltZS5jdXJyZW50KCkpOw0KICAgIGxvY2FsIHRoaXNEYXkgPSB0aW1lLmdldF9kYXkodGltZS5jdXJyZW50KCkpDQogICAgbG9jYWwgZGF0YSA9ew0KICAgICAgICB5ZWFyID0gdGhpc1llYXIgLA0KICAgICAgICBtb250aCA9IHRoaXNNb250aCAsDQogICAgICAgIGRheSA9IHRoaXNEYXkgLA0KICAgIH0NCiAgICBsb2NhbCB0aW1lU2hhbXNpID0gdGltZS50b19qYWxhbGkoZGF0YSk7DQoNCiAgICBpZiB0aW1lU2hhbXNpLnllYXIgfj0gbmlsIHRoZW4NCiAgICAgICAgdGhpc1llYXIgPSB0aW1lU2hhbXNpLnllYXI7DQogICAgZWxzZQ0KICAgICAgICB0aGlzWWVhciA9IDE0MDI7DQogICAgZW5kDQoNCiAgICByZXR1cm4gdGhpc1llYXI7DQplbmQNCmZ1bmN0aW9uIGdldFRpbWVTdGFydERheSgpDQogICAgbG9jYWwgdGhpc1llYXIgPSB0aW1lLmdldF95ZWFyKHRpbWUuY3VycmVudCgpKTsNCiAgICBsb2NhbCB0aGlzTW9udGggPSB0aW1lLmdldF9tb250aCh0aW1lLmN1cnJlbnQoKSk7DQogICAgbG9jYWwgdGhpc0RheSA9IHRpbWUuZ2V0X2RheSh0aW1lLmN1cnJlbnQoKSkNCiAgICBsb2NhbCB0aW1lTWlsYWRpID0gew0KICAgICAgICB5ZWFyID0gIHRoaXNZZWFyICwNCiAgICAgICAgbW9udGggPSB0aGlzTW9udGggLA0KICAgICAgICBkYXkgPSB0aGlzRGF5ICwNCiAgICAgICAgaG91ciA9IDAsDQogICAgICAgIG1pbnV0ZSA9IDAgLA0KICAgICAgICBzZWNvbmQgPSAwDQogICAgfTsNCiAgICByZXR1cm4gIHRpbWUuZ2V0X2ZpbGV0aW1lKHRpbWVNaWxhZGkpOw0KZW5kDQpmdW5jdGlvbiBnZXRUaW1lTGFzdFdlZWsoKQ0KICAgIHJldHVybiB0b3N0cmluZyh0aW1lLmN1cnJlbnQoKSArIDYwKjYwKjI0KjcqMTAwMDAwMDApOw0KZW5kDQpmdW5jdGlvbiB0b1RpbWVVbml4KHRpbWVTZWxlY3RlZCkNCiAgICBsb2NhbCBkYXkgPSB0aW1lLmdldF9kYXkodGltZVNlbGVjdGVkKTsNCiAgICBsb2NhbCBtb250aCA9IHRpbWUuZ2V0X21vbnRoKHRpbWVTZWxlY3RlZCk7DQogICAgbG9jYWwgeWVhciA9IHRpbWUuZ2V0X3llYXIodGltZVNlbGVjdGVkKTsNCiAgICBsb2NhbCB0ZW1wX3RpbWUgPSB0aW1lLmdldF9maWxldGltZShbW3sieWVhciI6XV0uLnllYXIuLltbLCJtb250aCI6XV0uLm1vbnRoLi5bWywiZGF5IjpdXS4uZGF5Li5bWywiaG91ciI6MCwibWludXRlIjowLCJzZWNvbmQiOjB9XV0pDQogICAgbG9jYWwgY3VycmVudGRhdGUgPSBzdHJpbmcuZm9ybWF0KCIlMTguMGYiLCB0ZW1wX3RpbWUpOw0KICAgIGxvY2FsIHRmPXRvc3RyaW5nKHRpbWUuZ2V0X3VuaXh0aW1lKGN1cnJlbnRkYXRlIC0tW1stIDc2MjAwMDAwMDAwMF1dKSkNCiAgICByZXR1cm4gc3RyaW5nLnN1Yih0ZiwxLCN0Zi0yKQ0KZW5kDQpmdW5jdGlvbiB1bml4VGltZVRvTWlsYWRpVGFibGUodW5peFRpbWUpDQogICAgbG9jYWwgZXBvY2ggPSAxOTcwDQogICAgbG9jYWwgZGF5cyA9IG1hdGguZmxvb3IodW5peFRpbWUgLyAoMjQgKiAzNjAwKSkNCiAgICBsb2NhbCBzZWNvbmRzSW5EYXkgPSB1bml4VGltZSAlICgyNCAqIDM2MDApDQogICAgbG9jYWwgaG91ciA9IG1hdGguZmxvb3Ioc2Vjb25kc0luRGF5IC8gMzYwMCkNCiAgICBsb2NhbCBtaW51dGUgPSBtYXRoLmZsb29yKChzZWNvbmRzSW5EYXkgJSAzNjAwKSAvIDYwKQ0KICAgIGxvY2FsIHNlY29uZCA9IG1hdGguZmxvb3Ioc2Vjb25kc0luRGF5ICUgNjApDQoNCiAgICBsb2NhbCB5ZWFyID0gZXBvY2gNCiAgICB3aGlsZSBkYXlzID49IDM2NSBkbw0KICAgICAgICBpZiAoeWVhciAlIDQgPT0gMCBhbmQgeWVhciAlIDEwMCB+PSAwKSBvciAoeWVhciAlIDQwMCA9PSAwKSB0aGVuDQogICAgICAgICAgICBpZiBkYXlzID49IDM2NiB0aGVuDQogICAgICAgICAgICAgICAgZGF5cyA9IGRheXMgLSAzNjYNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIGRheXMgPSBkYXlzIC0gMzY1DQogICAgICAgIGVuZA0KICAgICAgICB5ZWFyID0geWVhciArIDENCiAgICBlbmQNCg0KICAgIGxvY2FsIG1vbnRoRGF5cyA9IHszMSwgMjggKyAoKCh5ZWFyICUgNCA9PSAwIGFuZCB5ZWFyICUgMTAwIH49IDApIG9yICh5ZWFyICUgNDAwID09IDApKSBhbmQgMSBvciAwKSwgMzEsIDMwLCAzMSwgMzAsIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzF9DQoNCiAgICBsb2NhbCBtb250aCA9IDENCiAgICB3aGlsZSBkYXlzID49IG1vbnRoRGF5c1ttb250aF0gZG8NCiAgICAgICAgZGF5cyA9IGRheXMgLSBtb250aERheXNbbW9udGhdDQogICAgICAgIG1vbnRoID0gbW9udGggKyAxDQogICAgZW5kDQoNCiAgICBsb2NhbCBkYXkgPSBkYXlzICsgMQ0KDQogICAgcmV0dXJuIHllYXIsIG1vbnRoLCBkYXksIGhvdXIsIG1pbnV0ZSwgc2Vjb25kDQplbmQNCmZ1bmN0aW9uIHVuaXhUaW1lVG9NaWxhZGlTdHJpbmcodW5peFRpbWUgLCBzdHIpDQogICAgbG9jYWwgeWVhciwgbW9udGgsIGRheSwgaG91ciwgbWludXRlLCBzZWNvbmQgPSB1bml4VGltZVRvTWlsYWRpVGFibGUodW5peFRpbWUpOw0KICAgIGlmIHN0ciA9PSBuaWwgdGhlbg0KICAgICAgICBzdHIgPSAiJTA0ZC0lMDJkLSUwMmQiOw0KICAgIGVuZA0KDQogICAgcmV0dXJuIHN0cmluZy5mb3JtYXQoc3RyICwgeWVhciwgbW9udGgsIGRheSwgaG91ciwgbWludXRlLCBzZWNvbmQpDQplbmQNCmZ1bmN0aW9uIHVuaXhUaW1lVG9NaWxhZGlUaW1lU3RhbXAodW5peFRpbWUpDQogICAgbG9jYWwgeWVhciwgbW9udGgsIGRheSwgaG91ciwgbWludXRlLCBzZWNvbmQgPSB1bml4VGltZVRvTWlsYWRpVGFibGUodW5peFRpbWUpOw0KDQogICAgbG9jYWwgZGF5cyA9ICh5ZWFyIC0gMTk3MCkgKiAzNjUuMjUNCiAgICBkYXlzID0gZGF5cyArIChtb250aCAtIDEpICogMzAuNQ0KICAgIGRheXMgPSBkYXlzICsgZGF5IC0gMQ0KDQogICAgbG9jYWwgaG91cnMgPSBkYXlzICogMjQgKyBob3VyDQogICAgbG9jYWwgbWludXRlcyA9IGhvdXJzICogNjAgKyBtaW51dGUNCiAgICBsb2NhbCBzZWNvbmRzID0gbWludXRlcyAqIDYwICsgc2Vjb25kDQoNCiAgICByZXR1cm4gKHNlY29uZHMqX1RJTUVfVEVBTVlBUl9VTklUKSArIF9USU1FX1RFQU1ZQVJfRElGOw0KZW5kDQpmdW5jdGlvbiBjb21wYXJlU21hbGxlckRhdGVPbmVGcm9tRGF0ZVR3byhkYXRlT25lVG0gICwgZGF0ZVR3b1RtKQ0KICAgIHJldHVybiBkYXRlT25lVG0gPCBkYXRlVHdvVG07DQplbmQNCmZ1bmN0aW9uIGNvbXBhcmVMYXJnZXJEYXRlT25lRnJvbURhdGVUd28oZGF0ZU9uZVRtICAsIGRhdGVUd29UbSkNCiAgICByZXR1cm4gZGF0ZU9uZVRtID4gZGF0ZVR3b1RtOw0KZW5kDQoNCmZ1bmN0aW9uIGNvbnZlcnRUaW1lVGVhbXlhclRvVGltZVVuaXgodGltZUFyZykNCiAgICBpZiB0aW1lQXJnID09IG5pbCB0aGVuDQogICAgICAgIHRpbWVBcmcgPSB0aW1lLmN1cnJlbnQoKTsNCiAgICBlbmQNCiAgICByZXR1cm4gbWF0aC5mbG9vcih0aW1lQXJnIC8gX1RJTUVfVEVBTVlBUl9VTklUKSAtIF9USU1FX1RFQU1ZQVJfTUlEOw0KZW5kDQpmdW5jdGlvbiBjb252ZXJ0VGltZVVuaXhUb1RpbWVUZWFteWFyKHRpbWVBcmcpDQogICAgaWYgdGltZUFyZyA9PSBuaWwgdGhlbg0KICAgICAgICB0aW1lQXJnID0gdGltZS5jdXJyZW50KCk7DQogICAgZW5kDQogICAgcmV0dXJuIG1hdGguZmxvb3IoKHRpbWVBcmcrX1RJTUVfVEVBTVlBUl9NSUQpICogX1RJTUVfVEVBTVlBUl9VTklUKTsNCmVuZA0KDQoNCg0KDQoNCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0gREFURSBQRVJJT0QgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCmRhdGVQZXJpb2QgPSB7fTsNCmZ1bmN0aW9uIGRhdGVQZXJpb2Q6aW5pdCgpDQogICAgbG9jYWwgb2JqID0gew0KICAgICAgICBzdGFydERhdGUgPSAwICwNCiAgICAgICAgZW5kRGF0ZSA9IDAgLA0KICAgICAgICAtLQ0KICAgICAgICBxdWVyeSA9ICJzZWxlY3Qge3tzZWxlY3R9fSBmcm9tIHJlcG9ydF9kaW1kYXRlIHt7d2hlcmVEaW1EYXRlfX0iICwNCiAgICAgICAgbGlzdERhdGVzID0ge30sDQogICAgICAgIGlzSmFsYWxpRGF0ZSA9IHRydWUsDQogICAgICAgIC0tDQoNCiAgICB9DQogICAgb2JqLnNldFN0YXJ0RGF0ZSA9IHNlbGYuc2V0U3RhcnREYXRlOw0KICAgIG9iai5zZXRFbmREYXRlID0gc2VsZi5zZXRFbmREYXRlOw0KICAgIG9iai5nZXRMaXN0RGF0ZXMgPSBzZWxmLmdldExpc3REYXRlczsNCiAgICBvYmouc2V0SXNKYWxhbGlEYXRlID0gc2VsZi5zZXRJc0phbGFsaURhdGU7DQogICAgb2JqLmdldERhaWx5RGF0ZVBlcmlvZCA9IHNlbGYuZ2V0RGFpbHlEYXRlUGVyaW9kOw0KICAgIG9iai5nZXRNb250aGx5RGF0ZVBlcmlvZCA9IHNlbGYuZ2V0TW9udGhseURhdGVQZXJpb2Q7DQogICAgb2JqLmdldFllYXJseURhdGVQZXJpb2QgPSBzZWxmLmdldFllYXJseURhdGVQZXJpb2Q7DQogICAgb2JqLmdldEluZm9EYXRlU2VsZWN0ZWQgPSBzZWxmLmdldEluZm9EYXRlU2VsZWN0ZWQ7DQogICAgb2JqLmdldExhc3REYXlNb250aCA9IHNlbGYuZ2V0TGFzdERheU1vbnRoOw0KICAgIG9iai5nZXRMYXN0RGF5WWVhciA9IHNlbGYuZ2V0TGFzdERheVllYXI7DQogICAgcmV0dXJuIG9iajsNCmVuZA0KZnVuY3Rpb24gZGF0ZVBlcmlvZC5zZXRTdGFydERhdGUoc2VsZiAsIHN0YXJ0RGF0ZSkNCiAgICBpZiBzdGFydERhdGUgfj0gbmlsIHRoZW4NCiAgICAgICAgc2VsZi5zdGFydERhdGUgPSBzdGFydERhdGU7DQogICAgZW5kDQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGRhdGVQZXJpb2Quc2V0RW5kRGF0ZShzZWxmICwgZW5kRGF0ZSkNCiAgICBpZiBlbmREYXRlIH49IG5pbCB0aGVuDQogICAgICAgIHNlbGYuZW5kRGF0ZSA9IGVuZERhdGU7DQogICAgZW5kDQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGRhdGVQZXJpb2QuZ2V0TGlzdERhdGVzKHNlbGYpDQogICAgbG9jYWwgcXVlcnkgPSBzZWxmLnF1ZXJ5Ow0KICAgIGxvY2FsIHBhcmFtcyA9IHt9Ow0KDQogICAgcXVlcnkgLCBwYXJhbXMgPSB3aGVyZVF1ZXJ5OmluaXQoKQ0KICAgICAgICAgICAgOmFkZFNxbFdoZXJlKHNlbGYuc3RhcnREYXRlICwgIiBEQVRFS0VZID49PyAiICkNCiAgICAgICAgICAgIDphZGRTcWxXaGVyZShzZWxmLmVuZERhdGUgLCAiIERBVEVLRVkgPD0/ICIgKQ0KICAgICAgICAgICAgLnJ1bihxdWVyeSAsIHBhcmFtcyAsInt7d2hlcmVEaW1EYXRlfX0iKTsNCg0KICAgIGxvY2FsIHJlc3VsdCAgPSBiYXNlUXVlcnk6aW5pdCgpDQogICAgICAgICAgICA6c2V0UXVlcnkocXVlcnkpDQogICAgICAgICAgICA6c2V0Rmlyc3QoMCkNCiAgICAgICAgICAgIDpzZXRTZWxlY3RzKA0KICAgICAgICAgICAgICAgICAgIHsgY29sdW1uPSAnREFURUtFWScgLCBhbGlhcz0gJ0RBVEVLRVknIH0gLA0KDQogICAgICAgICAgICAgICAgICAgeyBjb2x1bW49ICdHWUVBUicgLCBhbGlhcz0gJ0dZRUFSJyB9ICwgeyBjb2x1bW49ICdHUVVBUlRFUicgLCBhbGlhcz0gJ0dRVUFSVEVSJyB9ICx7IGNvbHVtbj0gJ0dXRUVLJyAsIGFsaWFzPSAnR1dFRUsnIH0gLHsgY29sdW1uPSAnR1lEQVknICwgYWxpYXM9ICdHWURBWScgfSAsDQogICAgICAgICAgICAgICAgICAgeyBjb2x1bW49ICdHTURBWScgLCBhbGlhcz0gJ0dNREFZJyB9ICwgeyBjb2x1bW49ICdHTU9OVEgnICwgYWxpYXM9ICdHTU9OVEgnIH0gLCAgeyBjb2x1bW49ICdHTE1PTlRIJyAsIGFsaWFzPSAnR0xNT05USCcgfSAsIHsgY29sdW1uPSAnR1NNT05USCcgLCBhbGlhcz0gJ0dTTU9OVEgnIH0gLHsgY29sdW1uPSAnR1NNT05USCcgLCBhbGlhcz0gJ0dTTU9OVEgnIH0gLHsgY29sdW1uPSAnR1REQVknICwgYWxpYXM9ICdHVERBWScgfSAsDQogICAgICAgICAgICAgICAgICAge2NvbHVtbj0gJ0dOREFURScgLCBhbGlhcz0gJ0dOREFURSd9ICwge2NvbHVtbj0gJ0dUREFURScgLCBhbGlhcz0gJ0dUREFURSd9ICwNCg0KICAgICAgICAgICAgICAgICAgIHsgY29sdW1uPSAnSllFQVJLRVknICwgYWxpYXM9ICdKWUVBUktFWScgfSwgeyBjb2x1bW49ICdKUVVBUlRFUktFWScgLCBhbGlhcz0gJ0pRVUFSVEVSS0VZJyB9LCB7IGNvbHVtbj0gJ0pNT05USEtFWScgLCBhbGlhcz0gJ0pNT05USEtFWScgfSwgeyBjb2x1bW49ICdKV0VFS0tFWScgLCBhbGlhcz0gJ0pXRUVLS0VZJyB9ICwNCiAgICAgICAgICAgICAgICAgICB7IGNvbHVtbj0gJ0pZRUFSJyAsIGFsaWFzPSAnSllFQVInIH0sIHsgY29sdW1uPSAnSlFVQVJURVInICwgYWxpYXM9ICdKUVVBUlRFUicgfSx7IGNvbHVtbj0gJ0pNT05USCcgLCBhbGlhcz0gJ0pNT05USCcgfSx7IGNvbHVtbj0gJ0pXRUVLJyAsIGFsaWFzPSAnSldFRUsnIH0seyBjb2x1bW49ICdKWURBWScgLCBhbGlhcz0gJ0pZREFZJyB9LHsgY29sdW1uPSAnSk1EQVknICwgYWxpYXM9ICdKTURBWScgfSwNCiAgICAgICAgICAgICAgICAgICB7IGNvbHVtbj0gJ0pUTU9OVEgnICwgYWxpYXM9ICdKVE1PTlRIJyB9LCB7IGNvbHVtbj0gJ0pUREFZJyAsIGFsaWFzPSAnSlREQVknIH0sIHsgY29sdW1uPSAnSk5EQVRFJyAsIGFsaWFzPSAnSk5EQVRFJyB9DQogICAgICAgICAgICApDQogICAgICAgICAgICA6c2V0UGFyYW1zKHBhcmFtcykNCiAgICAgICAgICAgIC5mZXRjaCgpOw0KICAgIGlmIHJlc3VsdCB+PSBuaWwgICB0aGVuDQogICAgICAgIHNlbGYubGlzdERhdGVzID0gcmVzdWx0Ow0KICAgIGVuZA0KDQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGRhdGVQZXJpb2Quc2V0SXNKYWxhbGlEYXRlKHNlbGYpDQogICAgc2VsZi5pc0phbGFsaURhdGUgPSB1c2VyX2luZm8udXNlcklzTGFuZ3VhZ2VGYSgpOw0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBkYXRlUGVyaW9kLmdldERhaWx5RGF0ZVBlcmlvZChzZWxmKQ0KICAgIGxvY2FsIGxpc3QgPSB7fTsNCiAgICBmb3IgeCA9IDEgLCAjc2VsZi5saXN0RGF0ZXMgLCAxICAgZG8NCiAgICAgICAgbG9jYWwgaXRlbURhdGUgPSBzZWxmLmxpc3REYXRlc1t4XTsNCg0KICAgICAgICBsb2NhbCBrZXlTdGFydCA9ICBpdGVtRGF0ZS5EQVRFS0VZOw0KICAgICAgICBsb2NhbCBzdGFydERhdGEgPSBzZWxmOmdldEluZm9EYXRlU2VsZWN0ZWQoa2V5U3RhcnQpOw0KICAgICAgICBsb2NhbCBrZXlFbmQgPSAgIGl0ZW1EYXRlLkRBVEVLRVkgKyAyNCo2MCo2MCpfVElNRV9URUFNWUFSX1VOSVQ7DQogICAgICAgIGxvY2FsIGVuZERhdGEgPSBzZWxmOmdldEluZm9EYXRlU2VsZWN0ZWQoa2V5RW5kKTsNCg0KICAgICAgICBsb2NhbCBpdGVtRXhwID0gew0KICAgICAgICAgICAga2V5U3RhcnQgPSBzdGFydERhdGEua2V5ICwNCiAgICAgICAgICAgIGtleVN0YXJ0VGl0bGUgPSBzdGFydERhdGEua2V5VGl0bGUgLA0KICAgICAgICAgICAga2V5U3RhcnREYXlUaXRsZSA9IHN0YXJ0RGF0YS5rZXlEYXlUaXRsZSAsDQogICAgICAgICAgICBrZXlTdGFydE1vbnRoVGl0bGUgPSBzdGFydERhdGEua2V5TW9udGhUaXRsZSAsDQogICAgICAgICAgICBrZXlTdGFydFllYXJUaXRsZSA9IHN0YXJ0RGF0YS5rZXlZZWFyVGl0bGUgLA0KDQogICAgICAgICAgICBrZXlFbmQgPSBlbmREYXRhLmtleSAsDQogICAgICAgICAgICBrZXlFbmRUaXRsZSA9ICBlbmREYXRhLmtleVRpdGxlICwNCiAgICAgICAgICAgIGtleUVuZERheVRpdGxlID0gZW5kRGF0YS5rZXlEYXlUaXRsZSAsDQogICAgICAgICAgICBrZXlFbmRNb250aFRpdGxlID0gZW5kRGF0YS5rZXlNb250aFRpdGxlICwNCiAgICAgICAgICAgIGtleUVuZFllYXJUaXRsZSA9ICBlbmREYXRhLmtleVllYXJUaXRsZSAsDQogICAgICAgIH0NCiAgICAgICAgdGFibGUuaW5zZXJ0KGxpc3QgLCBpdGVtRXhwKTsNCiAgICBlbmQNCiAgICByZXR1cm4gbGlzdDsNCmVuZA0KZnVuY3Rpb24gZGF0ZVBlcmlvZC5nZXRNb250aGx5RGF0ZVBlcmlvZChzZWxmKQ0KICAgIGxvY2FsIGxpc3QgPSB7fTsNCg0KICAgIGZvciBpID0gMSAsICNzZWxmLmxpc3REYXRlcyAsIDEgICBkbw0KICAgICAgICBsb2NhbCBpdGVtRGF0ZSA9IHNlbGYubGlzdERhdGVzW2ldOw0KICAgICAgICBsb2NhbCBleGlzdCA9IGZhbHNlOw0KICAgICAgICBmb3IgeCA9IDEgLCAjbGlzdCAsIDEgICBkbw0KICAgICAgICAgICAgbG9jYWwgaXRlbURhdGVTZWxlY3RlZCA9IGxpc3RbeF07DQogICAgICAgICAgICBpZiBpdGVtRGF0ZVNlbGVjdGVkLmtleVN0YXJ0IDw9IGl0ZW1EYXRlLkRBVEVLRVkgYW5kICBpdGVtRGF0ZVNlbGVjdGVkLmtleUVuZCA+PWl0ZW1EYXRlLkRBVEVLRVkgdGhlbg0KICAgICAgICAgICAgICAgIGV4aXN0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCg0KICAgICAgICBpZiBleGlzdCA9PSBmYWxzZSB0aGVuDQogICAgICAgICAgICBsb2NhbCBrZXlTdGFydCA9ICBpdGVtRGF0ZS5EQVRFS0VZOw0KICAgICAgICAgICAgbG9jYWwgc3RhcnREYXRhID0gc2VsZjpnZXRJbmZvRGF0ZVNlbGVjdGVkKGtleVN0YXJ0KTsNCiAgICAgICAgICAgIGxvY2FsIGtleUVuZCA9ICBzZWxmOmdldExhc3REYXlNb250aChpdGVtRGF0ZSk7DQogICAgICAgICAgICBsb2NhbCBlbmREYXRhID0gc2VsZjpnZXRJbmZvRGF0ZVNlbGVjdGVkKGtleUVuZCk7DQoNCiAgICAgICAgICAgIGxvY2FsIGl0ZW1FeHAgPSB7DQogICAgICAgICAgICAgICAga2V5U3RhcnQgPSBzdGFydERhdGEua2V5ICwNCiAgICAgICAgICAgICAgICBrZXlTdGFydFRpdGxlID0gc3RhcnREYXRhLmtleVRpdGxlICwNCiAgICAgICAgICAgICAgICBrZXlTdGFydERheVRpdGxlID0gc3RhcnREYXRhLmtleURheVRpdGxlICwNCiAgICAgICAgICAgICAgICBrZXlTdGFydE1vbnRoVGl0bGUgPSBzdGFydERhdGEua2V5TW9udGhUaXRsZSAsDQogICAgICAgICAgICAgICAga2V5U3RhcnRZZWFyVGl0bGUgPSBzdGFydERhdGEua2V5WWVhclRpdGxlICwNCg0KICAgICAgICAgICAgICAgIGtleUVuZCA9IGVuZERhdGEua2V5ICwNCiAgICAgICAgICAgICAgICBrZXlFbmRUaXRsZSA9ICBlbmREYXRhLmtleVRpdGxlICwNCiAgICAgICAgICAgICAgICBrZXlFbmREYXlUaXRsZSA9IGVuZERhdGEua2V5RGF5VGl0bGUgLA0KICAgICAgICAgICAgICAgIGtleUVuZE1vbnRoVGl0bGUgPSBlbmREYXRhLmtleU1vbnRoVGl0bGUgLA0KICAgICAgICAgICAgICAgIGtleUVuZFllYXJUaXRsZSA9ICBlbmREYXRhLmtleVllYXJUaXRsZSAsDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRhYmxlLmluc2VydChsaXN0ICwgaXRlbUV4cCk7DQogICAgICAgIGVuZA0KICAgIGVuZA0KDQogICAgcmV0dXJuIGxpc3Q7DQplbmQNCmZ1bmN0aW9uIGRhdGVQZXJpb2QuZ2V0WWVhcmx5RGF0ZVBlcmlvZChzZWxmKQ0KICAgIGxvY2FsIGxpc3QgPSB7fTsNCg0KICAgIGZvciBpID0gMSAsICNzZWxmLmxpc3REYXRlcyAsIDEgICBkbw0KICAgICAgICBsb2NhbCBpdGVtRGF0ZSA9IHNlbGYubGlzdERhdGVzW2ldOw0KICAgICAgICBsb2NhbCBleGlzdCA9IGZhbHNlOw0KICAgICAgICBmb3IgeCA9IDEgLCAjbGlzdCAsIDEgICBkbw0KICAgICAgICAgICAgbG9jYWwgaXRlbURhdGVTZWxlY3RlZCA9IGxpc3RbeF07DQogICAgICAgICAgICBpZiBpdGVtRGF0ZVNlbGVjdGVkLmtleVN0YXJ0IDw9IGl0ZW1EYXRlLkRBVEVLRVkgYW5kICBpdGVtRGF0ZVNlbGVjdGVkLmtleUVuZCA+PWl0ZW1EYXRlLkRBVEVLRVkgdGhlbg0KICAgICAgICAgICAgICAgIGV4aXN0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCg0KICAgICAgICBpZiBleGlzdCA9PSBmYWxzZSB0aGVuDQogICAgICAgICAgICBsb2NhbCBrZXlTdGFydCA9ICBpdGVtRGF0ZS5EQVRFS0VZOw0KICAgICAgICAgICAgbG9jYWwgc3RhcnREYXRhID0gc2VsZjpnZXRJbmZvRGF0ZVNlbGVjdGVkKGtleVN0YXJ0KTsNCiAgICAgICAgICAgIGxvY2FsIGtleUVuZCA9ICBzZWxmOmdldExhc3REYXlZZWFyKGl0ZW1EYXRlKTsNCiAgICAgICAgICAgIGxvY2FsIGVuZERhdGEgPSBzZWxmOmdldEluZm9EYXRlU2VsZWN0ZWQoa2V5RW5kKTsNCg0KICAgICAgICAgICAgbG9jYWwgaXRlbUV4cCA9IHsNCiAgICAgICAgICAgICAgICBrZXlTdGFydCA9IHN0YXJ0RGF0YS5rZXkgLA0KICAgICAgICAgICAgICAgIGtleVN0YXJ0VGl0bGUgPSBzdGFydERhdGEua2V5VGl0bGUgLA0KICAgICAgICAgICAgICAgIGtleVN0YXJ0RGF5VGl0bGUgPSBzdGFydERhdGEua2V5RGF5VGl0bGUgLA0KICAgICAgICAgICAgICAgIGtleVN0YXJ0TW9udGhUaXRsZSA9IHN0YXJ0RGF0YS5rZXlNb250aFRpdGxlICwNCiAgICAgICAgICAgICAgICBrZXlTdGFydFllYXJUaXRsZSA9IHN0YXJ0RGF0YS5rZXlZZWFyVGl0bGUgLA0KDQogICAgICAgICAgICAgICAga2V5RW5kID0gZW5kRGF0YS5rZXkgLA0KICAgICAgICAgICAgICAgIGtleUVuZFRpdGxlID0gIGVuZERhdGEua2V5VGl0bGUgLA0KICAgICAgICAgICAgICAgIGtleUVuZERheVRpdGxlID0gZW5kRGF0YS5rZXlEYXlUaXRsZSAsDQogICAgICAgICAgICAgICAga2V5RW5kTW9udGhUaXRsZSA9IGVuZERhdGEua2V5TW9udGhUaXRsZSAsDQogICAgICAgICAgICAgICAga2V5RW5kWWVhclRpdGxlID0gIGVuZERhdGEua2V5WWVhclRpdGxlICwNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGxpc3QgLCBpdGVtRXhwKTsNCiAgICAgICAgZW5kDQogICAgZW5kDQoNCiAgICByZXR1cm4gbGlzdDsNCmVuZA0KZnVuY3Rpb24gZGF0ZVBlcmlvZC5nZXRJbmZvRGF0ZVNlbGVjdGVkKHNlbGYgLCBkYXRlS2V5U2VsZWN0ZWQpDQogICAgbG9jYWwgaXRlbUV4cCA9IHsNCiAgICAgICAga2V5ID0gZGF0ZUtleVNlbGVjdGVkICwNCiAgICAgICAga2V5VGl0bGUgPSAiIiAsDQogICAgICAgIGtleURheVRpdGxlID0gIiIgLA0KICAgICAgICBrZXlNb250aFRpdGxlID0gIiIgLA0KICAgICAgICBrZXlZZWFyVGl0bGUgPSAiIiAsDQogICAgfQ0KICAgIGZvciB4ID0gMSAsICNzZWxmLmxpc3REYXRlcyAsIDEgICBkbw0KICAgICAgICBsb2NhbCBpdGVtRGF0ZSA9IHNlbGYubGlzdERhdGVzW3hdOw0KICAgICAgICBpZiBpdGVtRGF0ZS5EQVRFS0VZID09IGRhdGVLZXlTZWxlY3RlZCB0aGVuDQogICAgICAgICAgICBpZiBzZWxmLmlzSmFsYWxpRGF0ZSB0aGVuDQogICAgICAgICAgICAgICAgaXRlbUV4cC5rZXlUaXRsZSA9IGl0ZW1EYXRlLkpOREFURQ0KICAgICAgICAgICAgICAgIGl0ZW1FeHAua2V5RGF5VGl0bGUgPSBpdGVtRGF0ZS5KVERBWQ0KICAgICAgICAgICAgICAgIGl0ZW1FeHAua2V5TW9udGhUaXRsZSA9IGl0ZW1EYXRlLkpUTU9OVEgNCiAgICAgICAgICAgICAgICBpdGVtRXhwLmtleVllYXJUaXRsZSA9IGl0ZW1EYXRlLkpZRUFSDQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgaXRlbUV4cC5rZXlUaXRsZSA9IGl0ZW1EYXRlLkdOREFURQ0KICAgICAgICAgICAgICAgIGl0ZW1FeHAua2V5RGF5VGl0bGUgPSBpdGVtRGF0ZS5HVERBWQ0KICAgICAgICAgICAgICAgIGl0ZW1FeHAua2V5TW9udGhUaXRsZSA9IGl0ZW1EYXRlLkdMTU9OVEgNCiAgICAgICAgICAgICAgICBpdGVtRXhwLmtleVllYXJUaXRsZSA9IGl0ZW1EYXRlLkdZRUFSDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gaXRlbUV4cDsNCmVuZA0KZnVuY3Rpb24gZGF0ZVBlcmlvZC5nZXRMYXN0RGF5TW9udGgoc2VsZiAsIGRhdGVLZXlTZWxlY3RlZCkNCiAgICBsb2NhbCBpdGVtRXhwID0gMDsNCiAgICBmb3IgeCA9IDEgLCAjc2VsZi5saXN0RGF0ZXMgLCAxICAgZG8NCiAgICAgICAgbG9jYWwgaXRlbURhdGUgPSBzZWxmLmxpc3REYXRlc1t4XTsNCiAgICAgICAgaWYgZGF0ZUtleVNlbGVjdGVkIH49IG5pbCBhbmQgaXRlbURhdGUuR1lFQVIgfj0gbmlsIGFuZCBpdGVtRGF0ZS5HTU9OVEggfj0gbmlsIGFuZCBpdGVtRGF0ZS5KWUVBUiB+PSBuaWwgYW5kIGl0ZW1EYXRlLkpNT05USCB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgaWYgc2VsZi5pc0phbGFsaURhdGU9PXRydWUgYW5kIGl0ZW1EYXRlLkpZRUFSID09IGRhdGVLZXlTZWxlY3RlZC5KWUVBUiAgYW5kIGl0ZW1EYXRlLkpNT05USCA9PSBkYXRlS2V5U2VsZWN0ZWQuSk1PTlRIIHRoZW4NCiAgICAgICAgICAgICAgICBpdGVtRXhwID0gaXRlbURhdGUuREFURUtFWTsNCiAgICAgICAgICAgIGVsc2VpZiBzZWxmLmlzSmFsYWxpRGF0ZT09ZmFsc2UgYW5kIGl0ZW1EYXRlLkdZRUFSID09IGRhdGVLZXlTZWxlY3RlZC5HWUVBUiAgYW5kIGl0ZW1EYXRlLkdNT05USCA9PSBkYXRlS2V5U2VsZWN0ZWQuR01PTlRIIHRoZW4NCiAgICAgICAgICAgICAgICBpdGVtRXhwID0gaXRlbURhdGUuREFURUtFWTsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCg0KICAgIHJldHVybiBpdGVtRXhwOw0KZW5kDQpmdW5jdGlvbiBkYXRlUGVyaW9kLmdldExhc3REYXlZZWFyKHNlbGYgLCBkYXRlS2V5U2VsZWN0ZWQpDQogICAgbG9jYWwgaXRlbUV4cCA9IDA7DQogICAgZm9yIHggPSAxICwgI3NlbGYubGlzdERhdGVzICwgMSAgIGRvDQogICAgICAgIGxvY2FsIGl0ZW1EYXRlID0gc2VsZi5saXN0RGF0ZXNbeF07DQogICAgICAgIGlmIGRhdGVLZXlTZWxlY3RlZCB+PSBuaWwgYW5kIGl0ZW1EYXRlLkdZRUFSIH49IG5pbCBhbmQgaXRlbURhdGUuSllFQVIgfj0gbmlsIHRoZW4NCiAgICAgICAgICAgIGlmIHNlbGYuaXNKYWxhbGlEYXRlPT10cnVlIGFuZCBpdGVtRGF0ZS5KWUVBUiA9PSBkYXRlS2V5U2VsZWN0ZWQuSllFQVIgdGhlbg0KICAgICAgICAgICAgICAgIGl0ZW1FeHAgPSBpdGVtRGF0ZS5EQVRFS0VZOw0KICAgICAgICAgICAgZWxzZWlmIHNlbGYuaXNKYWxhbGlEYXRlPT1mYWxzZSBhbmQgaXRlbURhdGUuR1lFQVIgPT0gZGF0ZUtleVNlbGVjdGVkLkdZRUFSICB0aGVuDQogICAgICAgICAgICAgICAgaXRlbUV4cCA9IGl0ZW1EYXRlLkRBVEVLRVk7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgcmV0dXJuIGl0ZW1FeHA7DQplbmQNCg==","mime":"text/plain","name":"Date_FromWork.lua"},{"file_content":"LS1EYXRhYmFzZV9Gcm9tV29yay5sdWENCmxvY2FsIF9DT1NUX0RCX01BSU49IjAwMDAwMDAiOw0KbG9jYWwgX0NPU1RfREJfQk9UPSIwMDAwMDAwX2JvdCI7DQoNCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0gUlVOIFNFTEVDVCBRVUVSSUVTID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tIEJBU0UgUVVFUlkgLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCmJhc2VRdWVyeSA9e30NCmZ1bmN0aW9uIGJhc2VRdWVyeTppbml0KCkNCiAgICBiYXNlUXVlcnkucXVlcnkgPSIiOw0KICAgIGJhc2VRdWVyeS5vdXRRdWVyeSA9IiI7DQogICAgYmFzZVF1ZXJ5LnNlbGVjdHMgPXt9Ow0KICAgIGJhc2VRdWVyeS5TVERzZWxlY3RzID17fTsNCiAgICBiYXNlUXVlcnkuZmlyc3QgPTE7DQogICAgYmFzZVF1ZXJ5LndoZXJlcyA9e307DQogICAgYmFzZVF1ZXJ5LmRiX25hbWUgPV9DT1NUX0RCX01BSU47DQogICAgcmV0dXJuIGJhc2VRdWVyeQ0KZW5kDQpmdW5jdGlvbiBiYXNlUXVlcnk6c2V0UXVlcnkocXVlcnkpDQogICAgYmFzZVF1ZXJ5LnF1ZXJ5ID0gcXVlcnk7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGJhc2VRdWVyeTpzZXRGaXJzdChmaXJzdCkNCiAgICBiYXNlUXVlcnkuZmlyc3QgPSBmaXJzdDsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYmFzZVF1ZXJ5OnNldFNlbGVjdHMoLi4uKQ0KICAgIGJhc2VRdWVyeS5zZWxlY3RzID0gey4uLn07DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGJhc2VRdWVyeTpzZXRUYWJsZVNlbGVjdHMoc2VsZWN0cykNCiAgICBiYXNlUXVlcnkuc2VsZWN0cyA9IHNlbGVjdHM7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGJhc2VRdWVyeTpzZXRQYXJhbXMocGFyYW1zKQ0KICAgIGJhc2VRdWVyeS5wYXJhbXMgPSBwYXJhbXM7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIGJhc2VRdWVyeTpzZXREQihkYl9uYW1lKQ0KICAgIGJhc2VRdWVyeS5kYl9uYW1lID0gZGJfbmFtZTsNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gYmFzZVF1ZXJ5OnNldERCTWFpbigpDQogICAgYmFzZVF1ZXJ5LmRiX25hbWUgPSBfQ09TVF9EQl9NQUlOOw0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBiYXNlUXVlcnk6c2V0REJCb3QoKQ0KICAgIGJhc2VRdWVyeS5kYl9uYW1lID0gX0NPU1RfREJfQk9UOw0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiBiYXNlUXVlcnkuZmV0Y2goZ2V0UHJpbnQpDQogICAgYmFzZVF1ZXJ5LnN0YW5kYXJkU2VsZWN0cygpOw0KICAgIGxvY2FsIHF1ZXJ5RGF0YSA9IHsNCiAgICAgICAgcXVlcnk9IGJhc2VRdWVyeTpnZXRRdWVyeSgpLA0KICAgICAgICBwYXJhbXMgPSBiYXNlUXVlcnkucGFyYW1zDQogICAgfQ0KDQogICAgaWYgZ2V0UHJpbnR+PSBuaWwgYW5kIGdldFByaW50PT10cnVlIHRoZW4NCiAgICAgICAgZGQoanNvbi5lbmNvZGUocXVlcnlEYXRhKSkNCiAgICBlbmQNCg0KICAgIGRiLnVzZV9kYihiYXNlUXVlcnkuZGJfbmFtZSkNCiAgICBkYi5xdWVyeShxdWVyeURhdGEpDQogICAgZGIudXNlX2RiKF9DT1NUX0RCX01BSU4pDQogICAgbG9jYWwgcmVjb3JkPXt9Ow0KICAgIGxvY2FsIHJlc3VsdEV4cCA9IHt9Ow0KICAgIGlmIGJhc2VRdWVyeS5maXJzdCA9PSAxIHRoZW4NCiAgICAgICAgZGIucXVlcnlfZmV0Y2gocmVjb3JkKQ0KICAgICAgICByZXN1bHRFeHAgPSBiYXNlUXVlcnkucmVhZHlJdGVtUmV0dXJuZWQocmVjb3JkKTsNCiAgICBlbHNlDQogICAgICAgIHdoaWxlIGRiLnF1ZXJ5X2ZldGNoKHJlY29yZCkgZG8NCiAgICAgICAgICAgIGxvY2FsIGl0ZW1SZXR1cm5lZCA9IGJhc2VRdWVyeS5yZWFkeUl0ZW1SZXR1cm5lZChyZWNvcmQpOw0KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHJlc3VsdEV4cCAsIGl0ZW1SZXR1cm5lZCkNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgZGIucXVlcnlfZnJlZSgpOw0KICAgIHJldHVybiByZXN1bHRFeHANCmVuZA0KZnVuY3Rpb24gYmFzZVF1ZXJ5LnN0YW5kYXJkU2VsZWN0cygpDQogICAgZm9yIGkgPSAxICwgI2Jhc2VRdWVyeS5zZWxlY3RzICwgMSAgIGRvDQogICAgICAgIGxvY2FsIGl0ZW1TZWxlY3QgPSBiYXNlUXVlcnkuc2VsZWN0c1tpXTsNCiAgICAgICAgbG9jYWwgYWxpYXMgPSAiIjsNCiAgICAgICAgbG9jYWwgY29sdW1uID0gIiI7DQogICAgICAgIGlmICh0eXBlKGl0ZW1TZWxlY3QpID09ICJ0YWJsZSIpIHRoZW4NCiAgICAgICAgICAgIGlmIGl0ZW1TZWxlY3QuY29sdW1uIH49IG5pbCBhbmQgI2l0ZW1TZWxlY3QuY29sdW1uID4gMCB0aGVuDQogICAgICAgICAgICAgICAgY29sdW1uID0gaXRlbVNlbGVjdC5jb2x1bW47DQogICAgICAgICAgICAgICAgaWYgaXRlbVNlbGVjdC5hbGlhcyB+PSBuaWwgYW5kICNpdGVtU2VsZWN0LmFsaWFzID4gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGFsaWFzID0gaXRlbVNlbGVjdC5hbGlhczsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIGFsaWFzID0gaXRlbVNlbGVjdC5jb2x1bW47DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgYWxpYXMgPSBpdGVtU2VsZWN0Ow0KICAgICAgICAgICAgY29sdW1uID0gaXRlbVNlbGVjdDsNCiAgICAgICAgZW5kDQogICAgICAgIHRhYmxlLmluc2VydChiYXNlUXVlcnkuU1REc2VsZWN0cyAsIHsNCiAgICAgICAgICAgIGNvbHVtbiA9IGNvbHVtbiAsDQogICAgICAgICAgICBhbGlhcyA9IGFsaWFzDQogICAgICAgIH0pDQogICAgZW5kDQplbmQNCmZ1bmN0aW9uIGJhc2VRdWVyeTpnZXRRdWVyeSgpDQogICAgbG9jYWwgb3V0UXVlcnkgPSBzdHJpbmcuZ3N1YihiYXNlUXVlcnkucXVlcnksICJ7e3NlbGVjdH19IiwgYmFzZVF1ZXJ5LnByZXByYXRpb25MaXN0U2VsZWN0KCkpDQogICAgcmV0dXJuIG91dFF1ZXJ5Ow0KZW5kDQpmdW5jdGlvbiBiYXNlUXVlcnkucHJlcHJhdGlvbkxpc3RTZWxlY3Qoc2VsZWN0KQ0KICAgIGxvY2FsIHJlc3VsdEV4cCA9ICcnOw0KICAgIGZvciBpID0gMSAsICNiYXNlUXVlcnkuU1REc2VsZWN0cyAsIDEgICBkbw0KICAgICAgICBsb2NhbCBpdGVtU2VsZWN0ID0gYmFzZVF1ZXJ5LlNURHNlbGVjdHNbaV07DQogICAgICAgIGxvY2FsIGFsaWFzID0gIiI7DQogICAgICAgIGxvY2FsIGNvbHVtbiA9ICIiOw0KICAgICAgICBpZiBpdGVtU2VsZWN0LmNvbHVtbiB+PSBuaWwgYW5kICNpdGVtU2VsZWN0LmNvbHVtbiA+IDAgdGhlbg0KICAgICAgICAgICAgY29sdW1uID0gaXRlbVNlbGVjdC5jb2x1bW47DQogICAgICAgIGVuZA0KICAgICAgICBpZiBpdGVtU2VsZWN0LmFsaWFzIH49IG5pbCBhbmQgI2l0ZW1TZWxlY3QuYWxpYXMgPiAwIHRoZW4NCiAgICAgICAgICAgIGFsaWFzID0gaXRlbVNlbGVjdC5hbGlhczsNCiAgICAgICAgZW5kDQoNCiAgICAgICAgcmVzdWx0RXhwID0gcmVzdWx0RXhwIC4uY29sdW1uLi4iIGFzICIuLiBhbGlhcyAuLiAiICINCiAgICAgICAgaWYgaX49ICNiYXNlUXVlcnkuU1REc2VsZWN0cyB0aGVuDQogICAgICAgICAgICByZXN1bHRFeHAgPSByZXN1bHRFeHAgLi4gIiAsICINCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgcmV0dXJuIHJlc3VsdEV4cDsNCmVuZA0KZnVuY3Rpb24gYmFzZVF1ZXJ5LnJlYWR5SXRlbVJldHVybmVkKHJlY29yZCkNCiAgICBsb2NhbCBpdGVtUmV0dXJuZWQgPSB7fTsNCiAgICBmb3IgaSA9IDEgLCAjYmFzZVF1ZXJ5LlNURHNlbGVjdHMgLCAxICAgZG8NCiAgICAgICAgbG9jYWwgaXRlbVNlbGVjdCA9IGJhc2VRdWVyeS5TVERzZWxlY3RzW2ldOw0KICAgICAgICBpZiByZWNvcmRbaV0gfj0gbmlsIHRoZW4NCiAgICAgICAgICAgIGl0ZW1SZXR1cm5lZFtpdGVtU2VsZWN0WyJhbGlhcyJdXSA9IHJlY29yZFtpXTsNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgcmV0dXJuIGl0ZW1SZXR1cm5lZDsNCmVuZA0KDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tIFdIRVJFIFFVRVJZIC0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCndoZXJlUXVlcnkgPXt9DQpmdW5jdGlvbiB3aGVyZVF1ZXJ5OmluaXQobGlzdFdoZXJlKQ0KICAgIHNlbGYucGFyYW1zID0ge307DQogICAgc2VsZi5saXN0V2hlcmUgPSB7fTsNCiAgICBpZiBsaXN0V2hlcmV+PW5pbCBhbmQgI2xpc3RXaGVyZT4wIHRoZW4NCiAgICAgICAgc2VsZi5saXN0V2hlcmUgPSBsaXN0V2hlcmUNCiAgICBlbmQNCiAgICByZXR1cm4gc2VsZg0KZW5kDQpmdW5jdGlvbiB3aGVyZVF1ZXJ5OmFkZFNxbFdoZXJlKHJlZmVyZW5jZSAsIHNxbFN0cmluZyAsIGdldFNpbmdsZVZhbHVlKQ0KICAgIGlmIGdldFNpbmdsZVZhbHVlfj1uaWwgYW5kIGdldFNpbmdsZVZhbHVlIHRoZW4NCiAgICAgICAgcmVmZXJlbmNlID0gd2hlcmVRdWVyeS5nZXRMaXN0SWRTaW5nbGUocmVmZXJlbmNlKTsNCiAgICBlbmQNCg0KICAgIGlmIHJlZmVyZW5jZX49IG5pbCAgdGhlbg0KICAgICAgICB0YWJsZS5pbnNlcnQod2hlcmVRdWVyeS5saXN0V2hlcmUgLCAgc3FsU3RyaW5nKQ0KICAgICAgICB0YWJsZS5pbnNlcnQod2hlcmVRdWVyeS5wYXJhbXMgLCByZWZlcmVuY2UpDQogICAgZW5kDQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIHdoZXJlUXVlcnk6YWRkU3FsV2hlcmVJbihyZWZlcmVuY2UgLCBjb2x1bW5OYW1lICwgbm90SW5PYmplY3QpDQogICAgcmVmZXJlbmNlID0gd2hlcmVRdWVyeS5nZXRMaXN0SWRNdWx0aShyZWZlcmVuY2UgLCBub3RJbk9iamVjdCk7DQogICAgaWYgcmVmZXJlbmNlIH49IG5pbCBhbmQgI3JlZmVyZW5jZSA+IDAgdGhlbg0KICAgICAgICBsb2NhbCBxdWVyeSA9ICIgIi4uY29sdW1uTmFtZS4uIiAiOw0KICAgICAgICBxdWVyeSA9IHF1ZXJ5IC4uICIgaW4gKCAiOw0KICAgICAgICBmb3IgaSA9IDEgLCNyZWZlcmVuY2UgLCAxIGRvDQogICAgICAgICAgICBsb2NhbCBpdGVtUXVlcnlXaGVyZSA9IHJlZmVyZW5jZVtpXTsNCiAgICAgICAgICAgIHRhYmxlLmluc2VydCh3aGVyZVF1ZXJ5LnBhcmFtcyAsaXRlbVF1ZXJ5V2hlcmUpDQogICAgICAgICAgICBxdWVyeSA9IHF1ZXJ5Li4iPyI7DQogICAgICAgICAgICBpZiBpIDwgI3JlZmVyZW5jZSAgIHRoZW4NCiAgICAgICAgICAgICAgICBxdWVyeSA9IHF1ZXJ5IC4uICIsIg0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgICAgICBxdWVyeSA9IHF1ZXJ5Li4gIiApICINCiAgICAgICAgdGFibGUuaW5zZXJ0KHdoZXJlUXVlcnkubGlzdFdoZXJlICxxdWVyeSkNCiAgICBlbmQNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gd2hlcmVRdWVyeTphZGRTcWxXaGVyZUxpa2UocmVmZXJlbmNlICwgY29sdW1uTmFtZSkNCiAgICBpZiByZWZlcmVuY2Ugfj0gbmlsIGFuZCAjcmVmZXJlbmNlID4gMCB0aGVuDQogICAgICAgIGxvY2FsIHF1ZXJ5ID0iKCIgOw0KICAgICAgICBxdWVyeSA9IHF1ZXJ5IC4uIiAoIiAuLiBjb2x1bW5OYW1lLi4iIGxpa2UgPykgb3IgIjsNCiAgICAgICAgdGFibGUuaW5zZXJ0KHdoZXJlUXVlcnkucGFyYW1zICxyZWZlcmVuY2UpDQoNCiAgICAgICAgcXVlcnkgPSBxdWVyeSAuLiIgKCIgLi4gY29sdW1uTmFtZS4uIiBsaWtlIChjb25jYXQoPyAsICclJScpKSApIG9yICI7DQogICAgICAgIHRhYmxlLmluc2VydCh3aGVyZVF1ZXJ5LnBhcmFtcyAscmVmZXJlbmNlKQ0KDQogICAgICAgIHF1ZXJ5ID0gcXVlcnkgLi4iICgiIC4uIGNvbHVtbk5hbWUuLiIgbGlrZSAoY29uY2F0KCAnJSUnICwgPyApKSApIG9yICI7DQogICAgICAgIHRhYmxlLmluc2VydCh3aGVyZVF1ZXJ5LnBhcmFtcyAsIHJlZmVyZW5jZSkNCg0KICAgICAgICBxdWVyeSA9IHF1ZXJ5IC4uIiAoIiAuLiBjb2x1bW5OYW1lLi4iIGxpa2UgKGNvbmNhdCggJyUlJyAsID8gICwgJyUlJykpICkgICI7DQogICAgICAgIHRhYmxlLmluc2VydCh3aGVyZVF1ZXJ5LnBhcmFtcyAsIHJlZmVyZW5jZSkNCiAgICAgICAgcXVlcnkgPSBxdWVyeS4uICIgKSAiDQoNCiAgICAgICAgdGFibGUuaW5zZXJ0KHdoZXJlUXVlcnkubGlzdFdoZXJlICwgIHF1ZXJ5KQ0KICAgIGVuZA0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiB3aGVyZVF1ZXJ5OmFkZFNxbFdoZXJlTGlrZUxpc3QocmVmZXJlbmNlICwgY29sdW1uTmFtZSApDQogICAgaWYgcmVmZXJlbmNlIH49IG5pbCBhbmQgI3JlZmVyZW5jZSA+IDAgdGhlbg0KDQogICAgICAgIGxvY2FsIGxpc3RJbnB1dCA9IHt9Ow0KICAgICAgICBmb3IgaSA9IDEgLCNyZWZlcmVuY2UgLCAxIGRvDQogICAgICAgICAgICBsb2NhbCBpdGVtID0gcmVmZXJlbmNlW2ldOw0KICAgICAgICAgICAgaWYgaXRlbS5pZCB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChsaXN0SW5wdXQgLCBpdGVtLmlkKQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KDQogICAgICAgIGxvY2FsIHF1ZXJ5ID0iKCIgOw0KICAgICAgICBmb3IgeCA9IDEgLCNsaXN0SW5wdXQgLCAxIGRvDQogICAgICAgICAgICBsb2NhbCBpdGVtID0gbGlzdElucHV0W3hdOw0KICAgICAgICAgICAgcXVlcnkgPSBxdWVyeSAuLiIgIiAuLiBjb2x1bW5OYW1lLi4iIGxpa2UgY29uY2F0KD8gLCAnJSUnKSAiOw0KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHdoZXJlUXVlcnkucGFyYW1zICxpdGVtKQ0KICAgICAgICAgICAgaWYgeCA8ICNsaXN0SW5wdXQgdGhlbg0KICAgICAgICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkgLi4iIG9yICI7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIHF1ZXJ5ID0gcXVlcnkuLiAiICkgIg0KDQogICAgICAgIHRhYmxlLmluc2VydCh3aGVyZVF1ZXJ5Lmxpc3RXaGVyZSAsICBxdWVyeSkNCiAgICBlbmQNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gd2hlcmVRdWVyeS5yZWFkeVdoZXJlKCkNCiAgICBsb2NhbCBxdWVyeT0gIiI7DQogICAgaWYgd2hlcmVRdWVyeS5saXN0V2hlcmV+PW5pbCBhbmQgI3doZXJlUXVlcnkubGlzdFdoZXJlPjAgdGhlbg0KICAgICAgICBxdWVyeSA9ICIgd2hlcmUgIjsNCiAgICAgICAgZm9yIGkgPSAxICwjd2hlcmVRdWVyeS5saXN0V2hlcmUgLCAxIGRvDQogICAgICAgICAgICBsb2NhbCBpdGVtUXVlcnlXaGVyZSA9IHdoZXJlUXVlcnkubGlzdFdoZXJlW2ldOw0KICAgICAgICAgICAgcXVlcnkgPSBxdWVyeSAuLiAiICIuLml0ZW1RdWVyeVdoZXJlLi4iICI7DQogICAgICAgICAgICBpZiBpIDwgI3doZXJlUXVlcnkubGlzdFdoZXJlIHRoZW4NCiAgICAgICAgICAgICAgICBxdWVyeSA9IHF1ZXJ5IC4uICIgYW5kICINCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gcXVlcnk7DQplbmQNCmZ1bmN0aW9uIHdoZXJlUXVlcnkuZ2V0TGlzdElkU2luZ2xlKHJlZmVyZW5jZSkNCiAgICBpZiByZWZlcmVuY2Ugfj0gbmlsIHRoZW4NCiAgICAgICAgaWYgcmVmZXJlbmNlLmlkIH49IG51bGwgdGhlbg0KICAgICAgICAgICAgcmV0dXJuIHJlZmVyZW5jZS5pZDsNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgcmV0dXJuIG5pbDsNCmVuZA0KZnVuY3Rpb24gd2hlcmVRdWVyeS5nZXRMaXN0SWRNdWx0aShyZWZlcmVuY2UgLCBub3RJbk9iamVjdCkNCiAgICBsb2NhbCBsaXN0SWQgPSBuaWw7DQogICAgaWYgcmVmZXJlbmNlIH49IG5pbCB0aGVuDQogICAgICAgIGxpc3RJZCA9IHt9Ow0KICAgICAgICBsb2NhbCBnZXRBcnJheUlkID0gdG9UYWJsZShyZWZlcmVuY2UpDQogICAgICAgIGlmICNnZXRBcnJheUlkID4gMCB0aGVuDQogICAgICAgICAgICBmb3IgaSA9IDEsICNnZXRBcnJheUlkICwgMSBkbw0KICAgICAgICAgICAgICAgIGxvY2FsIGl0ZW1JZCA9IGdldEFycmF5SWRbaV07DQogICAgICAgICAgICAgICAgaWYgbm90SW5PYmplY3QgPT0gbmlsIG9yICAobm90SW5PYmplY3Qgfj0gbmlsIGFuZCBub3RJbk9iamVjdCA9PSBmYWxzZSkgIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgaXRlbUlkID0gZ2V0UGFyYW1Ub051bWJlcihpdGVtSWQgLCAiaWQiKSAgOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGlmIGl0ZW1JZCA+IDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQobGlzdElkICwgaXRlbUlkKQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBsaXN0SWQ7DQplbmQNCmZ1bmN0aW9uIHdoZXJlUXVlcnkucnVuKHF1ZXJ5ICwgcGFyYW1zICwgcGF0dGVybikNCiAgICBsb2NhbCBxdWVyeU91dCA9IHdoZXJlUXVlcnkucmVhZHlXaGVyZSgpOw0KICAgIGZvciBpID0gMSAsI3doZXJlUXVlcnkucGFyYW1zICwgMSBkbw0KICAgICAgICBsb2NhbCBpdGVtUGFyYW0gPSB3aGVyZVF1ZXJ5LnBhcmFtc1tpXTsNCiAgICAgICAgdGFibGUuaW5zZXJ0KHBhcmFtcyAsIGl0ZW1QYXJhbSApDQogICAgZW5kDQogICAgcmV0dXJuIHN0cmluZy5nc3ViKHF1ZXJ5LCBwYXR0ZXJuLCBxdWVyeU91dCkgLCBwYXJhbXM7DQplbmQNCg0KDQoNCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0gQ09OVEVYVCBGT1IgVEFCTEVTIElOIEJPVCA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tIGRiX2JvdCBjb250ZXh0IFFVRVJZIC0tLS0tLS0tLS0NCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCnRhYmxlRGF0YSA9IHt9Ow0KZnVuY3Rpb24gdGFibGVEYXRhOmluaXQocHJlZml4ICwgbmFtZSAsIGNvbHVtbnMgLCBpbmRleGVzKQ0KICAgIGlmIHByZWZpeCA9PSBuaWwgb3IgcHJlZml4ID09ICIiIHRoZW4NCiAgICAgICAgcHJlZml4ID0gInByZWZpeCI7DQogICAgZW5kDQogICAgc2VsZi5wcmVmaXggPSBwcmVmaXg7DQogICAgc2VsZi5uYW1lID0gbmFtZTsNCiAgICBzZWxmLmNvbHVtbnMgPSBjb2x1bW5zOw0KICAgIHNlbGYuaW5kZXhlcyA9IGluZGV4ZXM7DQogICAgcmV0dXJuIHNlbGY7DQplbmQNCi0tLQ0KZnVuY3Rpb24gdGFibGVEYXRhLmNyZWF0ZUFuZENoZWNrRXhpc3QoKQ0KICAgIHJldHVybiAgdGFibGVDcmVhdGU6aW5pdCh0YWJsZURhdGEucHJlZml4ICwgdGFibGVEYXRhLm5hbWUgLCB0YWJsZURhdGEuY29sdW1ucyAsIHRhYmxlRGF0YS5pbmRleGVzKS5ydW4oKTsNCmVuZA0KLS0tDQpmdW5jdGlvbiB0YWJsZURhdGEuZ2V0U2VsZWN0UmVzdWx0KHF1ZXJ5ICwgZmlyc3QgLCBwYXJhbXMpDQogICAgdGFibGVEYXRhLmNyZWF0ZUFuZENoZWNrRXhpc3QoKTsNCiAgICByZXR1cm4gdGFibGVTZWxlY3Q6aW5pdChxdWVyeSAsIGZpcnN0ICwgdGFibGVEYXRhLmNvbHVtbnMgLCBwYXJhbXMpLnJ1bigpDQplbmQNCmZ1bmN0aW9uIHRhYmxlRGF0YS5nZXRBbGxSZXN1bHQoKQ0KICAgIHRhYmxlRGF0YS5jcmVhdGVBbmRDaGVja0V4aXN0KCk7DQogICAgbG9jYWwgcXVlcnkgPSAiU0VMRUNUIHt7c2VsZWN0fX0gRlJPTSAiLi50YWJsZURhdGEucHJlZml4Li4iXyIuLnRhYmxlRGF0YS5uYW1lIDsNCiAgICByZXR1cm4gdGFibGVTZWxlY3Q6aW5pdChxdWVyeSAsIDAgLCB0YWJsZURhdGEuY29sdW1ucykucnVuKCkNCmVuZA0KZnVuY3Rpb24gdGFibGVEYXRhLmdldEZpcnN0UmVzdWx0KGlkRmlyc3QpDQogICAgdGFibGVEYXRhLmNyZWF0ZUFuZENoZWNrRXhpc3QoKTsNCiAgICBsb2NhbCBxdWVyeSA9ICJTRUxFQ1Qge3tzZWxlY3R9fSBGUk9NICIuLnRhYmxlRGF0YS5wcmVmaXguLiJfIi4udGFibGVEYXRhLm5hbWUuLiIgd2hlcmUgaWQ9PyIgIDsNCiAgICByZXR1cm4gdGFibGVTZWxlY3Q6aW5pdChxdWVyeSAsIDEgLCB0YWJsZURhdGEuY29sdW1ucyAsIHtpZEZpcnN0fSkucnVuKCk7DQplbmQNCi0tLQ0KZnVuY3Rpb24gdGFibGVEYXRhLmFkZFJlc3VsdChkYXRhKQ0KICAgIHRhYmxlRGF0YS5jcmVhdGVBbmRDaGVja0V4aXN0KCk7DQogICAgcmV0dXJuIHRhYmxlSW5zZXJ0OmluaXQodGFibGVEYXRhLnByZWZpeCAsIHRhYmxlRGF0YS5uYW1lICwgdGFibGVEYXRhLmNvbHVtbnMgLCBkYXRhKS5ydW4oKTsNCmVuZA0KLS0tDQpmdW5jdGlvbiB0YWJsZURhdGEudXBkYXRlUmVzdWx0KHdoZXJlICwgcGFyYW1zICwgZGF0YSkNCiAgICB0YWJsZURhdGEuY3JlYXRlQW5kQ2hlY2tFeGlzdCgpDQogICAgcmV0dXJuIHRhYmxlVXBkYXRlOmluaXQodGFibGVEYXRhLnByZWZpeCAsIHRhYmxlRGF0YS5uYW1lICwgdGFibGVEYXRhLmNvbHVtbnMgLHdoZXJlICwgcGFyYW1zICwgZGF0YSkucnVuKCk7DQplbmQNCi0tLQ0KZnVuY3Rpb24gdGFibGVEYXRhLmRlbGV0ZVJlc3VsdCh3aGVyZSAsIHBhcmFtcykNCiAgICB0YWJsZURhdGEuY3JlYXRlQW5kQ2hlY2tFeGlzdCgpDQogICAgcmV0dXJuIHRhYmxlRGVsZXRlOmluaXQodGFibGVEYXRhLnByZWZpeCAsIHRhYmxlRGF0YS5uYW1lICwgd2hlcmUgLCBwYXJhbXMpLnJ1bigpOw0KZW5kDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQotLSBjcmVhdGUgVGFibGUNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQp0YWJsZUNyZWF0ZSA9IHt9Ow0KZnVuY3Rpb24gdGFibGVDcmVhdGU6aW5pdChwcmVmaXggLCBuYW1lICwgY29sdW1ucyAsIGluZGV4ZXMpDQogICAgc2VsZi5wcmVmaXggPSBwcmVmaXg7DQogICAgc2VsZi5uYW1lID0gbmFtZTsNCiAgICBzZWxmLmNvbHVtbnMgPSBjb2x1bW5zOw0KICAgIHNlbGYuaW5kZXhlcyA9IGluZGV4ZXM7DQogICAgLS0tDQogICAgc2VsZi5maWVsZHMgPSAiIjsNCiAgICBzZWxmLmluZGV4X2l0ZW1zID0ge307DQogICAgcmV0dXJuIHNlbGYNCmVuZA0KZnVuY3Rpb24gdGFibGVDcmVhdGU6ZmllbGRzVG9TdHJpbmcoKQ0KICAgIGxvY2FsIGxpc3RDb2x1bW49e307DQogICAgZm9yIGkgPSAxICwgI3RhYmxlQ3JlYXRlLmNvbHVtbnMgLCAxICAgZG8NCiAgICAgICAgbG9jYWwgaXRlbUNvbHVtbiA9IHRhYmxlQ3JlYXRlLmNvbHVtbnNbaV07DQogICAgICAgIGlmIGlzc2V0S2V5KGl0ZW1Db2x1bW4gLCAiY29sdW1uIikgYW5kICBpc3NldEtleShpdGVtQ29sdW1uICwgImRlZmluZSIpIHRoZW4NCiAgICAgICAgICAgIHRhYmxlLmluc2VydChsaXN0Q29sdW1uICwgew0KICAgICAgICAgICAgICAgIGNvbHVtbiA9IGl0ZW1Db2x1bW4uY29sdW1uICwNCiAgICAgICAgICAgICAgICBkZWZpbmUgPSBpdGVtQ29sdW1uLmRlZmluZSAsDQogICAgICAgICAgICB9KQ0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICBmb3IgaSA9IDEgLCAjbGlzdENvbHVtbiAsIDEgICBkbw0KICAgICAgICBsb2NhbCBpdGVtQ29sdW1uID0gbGlzdENvbHVtbltpXTsNCiAgICAgICAgc2VsZi5maWVsZHMgPSBzZWxmLmZpZWxkcyAuLiBpdGVtQ29sdW1uLmNvbHVtbiAuLiAiICIgLi4gaXRlbUNvbHVtbi5kZWZpbmUgOw0KICAgICAgICBpZiBpIDwgI2xpc3RDb2x1bW4gdGhlbg0KICAgICAgICAgICAgc2VsZi5maWVsZHMgPSBzZWxmLmZpZWxkcyAuLiAiICwgIg0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gdGFibGVDcmVhdGU6cmVhZHlJbmRleEFycmF5KCkNCiAgICBmb3IgaSA9IDEgLCAjdGFibGVDcmVhdGUuaW5kZXhlcyAsIDEgICBkbw0KICAgICAgICBsb2NhbCBpdGVtSW5kZXggPSB0YWJsZUNyZWF0ZS5pbmRleGVzW2ldOw0KDQogICAgICAgIGxvY2FsIGZsYWcgPSAyOw0KICAgICAgICBpZiBpc3NldEtleShpdGVtSW5kZXggLCAiZmxhZyIpICB0aGVuDQogICAgICAgICAgICBmbGFnID0gaXRlbUluZGV4LmZsYWc7DQogICAgICAgIGVuZA0KICAgICAgICBpZiBpc3NldEtleShpdGVtSW5kZXggLCAiY29sdW1uIikgYW5kICBpc3NldEtleShpdGVtSW5kZXggLCAiaW5kZXgiKSB0aGVuDQogICAgICAgICAgICB0YWJsZS5pbnNlcnQodGFibGVDcmVhdGUuaW5kZXhfaXRlbXMgLCB7DQogICAgICAgICAgICAgICAgZmxhZywgaXRlbUluZGV4LmluZGV4ICwgaXRlbUluZGV4LmNvbHVtbg0KICAgICAgICAgICAgfSkNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIHRhYmxlQ3JlYXRlLnJ1bigpDQogICAgdGFibGVDcmVhdGU6ZmllbGRzVG9TdHJpbmcoKTpyZWFkeUluZGV4QXJyYXkoKTsNCiAgICBsb2NhbCB0YWJsZURhdGE9ew0KICAgICAgICBuYW1lPSB0YWJsZUNyZWF0ZS5wcmVmaXguLiJfIi4udGFibGVDcmVhdGUubmFtZSwNCiAgICAgICAgZmllbGRzPSB0YWJsZUNyZWF0ZS5maWVsZHMsDQogICAgICAgIGluZGV4X2l0ZW1zPSB0YWJsZUNyZWF0ZS5pbmRleF9pdGVtczsNCiAgICB9Ow0KDQogICAgZGIudXNlX2RiKF9DT1NUX0RCX0JPVCkNCiAgICBsb2NhbCByZXMgPSBkYi5jaGVja190YWJsZSh0YWJsZURhdGEpDQogICAgZGIudXNlX2RiKF9DT1NUX0RCX01BSU4pDQoNCiAgICByZXR1cm4ge3N0YXR1cz10cnVlICwgbXNnPSJjcmVhdGVkIiAsIGRhdGE9dGFibGVEYXRhfQ0KZW5kDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQotLSBzZWxlY3QgVGFibGUNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQp0YWJsZVNlbGVjdCA9IHt9Ow0KZnVuY3Rpb24gdGFibGVTZWxlY3Q6aW5pdChxdWVyeSAsIGZpcnN0ICwgY29sdW1ucyAsIHBhcmFtcykNCiAgICBzZWxmLnF1ZXJ5ID0gcXVlcnk7DQogICAgc2VsZi5maXJzdCA9IGZpcnN0Ow0KICAgIHNlbGYuY29sdW1ucyA9IGNvbHVtbnM7DQogICAgc2VsZi5wYXJhbXMgPSBwYXJhbXM7DQogICAgLS0tDQogICAgc2VsZi5yZXN1bHRDb2x1bW5zID0ge307DQogICAgcmV0dXJuIHNlbGYNCmVuZA0KZnVuY3Rpb24gdGFibGVTZWxlY3QucnVuKCkNCiAgICByZXR1cm4gYmFzZVF1ZXJ5OmluaXQoKQ0KICAgICAgICAgICAgOnNldFF1ZXJ5KHRhYmxlU2VsZWN0LnF1ZXJ5KQ0KICAgICAgICAgICAgOnNldEZpcnN0KHRhYmxlU2VsZWN0LmZpcnN0KQ0KICAgICAgICAgICAgOnNldFRhYmxlU2VsZWN0cyh0YWJsZVNlbGVjdC5jb2x1bW5zKQ0KICAgICAgICAgICAgOnNldFBhcmFtcyh0YWJsZVNlbGVjdC5wYXJhbXMpDQogICAgICAgICAgICA6c2V0REIoX0NPU1RfREJfQk9UKQ0KICAgICAgICAgICAgLmZldGNoKCk7DQplbmQNCg0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tIGluc2VydCBUYWJsZQ0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCnRhYmxlSW5zZXJ0ID0ge307DQpmdW5jdGlvbiB0YWJsZUluc2VydDppbml0KHByZWZpeCAsIG5hbWUgLCBjb2x1bW5zICwgZGF0YSkNCiAgICBzZWxmLnByZWZpeCA9IHByZWZpeDsNCiAgICBzZWxmLm5hbWUgPSBuYW1lOw0KICAgIHNlbGYuY29sdW1ucyA9IGNvbHVtbnM7DQogICAgc2VsZi5kYXRhID0gZGF0YTsNCiAgICAtLS0NCiAgICBzZWxmLmFsbG93RGF0YSA9IHt9Ow0KICAgIHNlbGYuY29sdW1uc0luc2VydD0iIjsNCiAgICBzZWxmLmRhdGFJbnNlcnQ9IiI7DQogICAgc2VsZi5wYXJhbXM9e307DQogICAgcmV0dXJuIHNlbGYNCmVuZA0KZnVuY3Rpb24gdGFibGVJbnNlcnQ6Y29sdW1uQWxsb3dEYXRhKCkNCiAgICBmb3IgaSA9IDEgLCAjdGFibGVJbnNlcnQuZGF0YSAsIDEgICBkbw0KICAgICAgICBsb2NhbCBpdGVtRGF0YSA9IHRhYmxlSW5zZXJ0LmRhdGFbaV07DQogICAgICAgIGxvY2FsIGV4aXN0RGF0YSA9IGZhbHNlOw0KICAgICAgICBpZiBpc3NldEtleShpdGVtRGF0YSAsICJjb2x1bW4iKSBhbmQgIGlzc2V0S2V5KGl0ZW1EYXRhICwgInZhbHVlIikgdGhlbg0KICAgICAgICAgICAgZm9yIHggPSAxICwgI3RhYmxlSW5zZXJ0LmNvbHVtbnMgLCAxICAgZG8NCiAgICAgICAgICAgICAgICBsb2NhbCBpdGVtQ29sdW1uID0gdGFibGVJbnNlcnQuY29sdW1uc1t4XTsNCiAgICAgICAgICAgICAgICBpZiBpc3NldEtleShpdGVtQ29sdW1uICwgImNvbHVtbiIpIGFuZCBpdGVtRGF0YS5jb2x1bW4gPT0gaXRlbUNvbHVtbi5jb2x1bW4gIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZXhpc3REYXRhID10cnVlOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgICAgICBpZiBleGlzdERhdGEgdGhlbg0KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHRhYmxlSW5zZXJ0LmFsbG93RGF0YSAsIGl0ZW1EYXRhKQ0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gdGFibGVJbnNlcnQ6cmVhZHlBcmd1bWVudEluc2VydCgpDQogICAgZm9yIGkgPSAxICwgI3RhYmxlSW5zZXJ0LmFsbG93RGF0YSAsIDEgICBkbw0KICAgICAgICBsb2NhbCBpdGVtRGF0YSA9IHRhYmxlSW5zZXJ0LmFsbG93RGF0YVtpXTsNCiAgICAgICAgdGFibGVJbnNlcnQuY29sdW1uc0luc2VydCA9IHRhYmxlSW5zZXJ0LmNvbHVtbnNJbnNlcnQgLi4gaXRlbURhdGEuY29sdW1uICA7DQogICAgICAgIHRhYmxlSW5zZXJ0LmRhdGFJbnNlcnQgPSB0YWJsZUluc2VydC5kYXRhSW5zZXJ0IC4uICI/IiAgOw0KICAgICAgICB0YWJsZS5pbnNlcnQodGFibGVJbnNlcnQucGFyYW1zICwgaXRlbURhdGEudmFsdWUpDQogICAgICAgIGlmIGkgPCAjdGFibGVJbnNlcnQuYWxsb3dEYXRhIHRoZW4NCiAgICAgICAgICAgIHRhYmxlSW5zZXJ0LmNvbHVtbnNJbnNlcnQgPSB0YWJsZUluc2VydC5jb2x1bW5zSW5zZXJ0IC4uICIgLCAiDQogICAgICAgICAgICB0YWJsZUluc2VydC5kYXRhSW5zZXJ0ID0gdGFibGVJbnNlcnQuZGF0YUluc2VydCAuLiAiICwgIg0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gc2VsZjsNCmVuZA0KZnVuY3Rpb24gdGFibGVJbnNlcnQucnVuKCkNCiAgICB0YWJsZUluc2VydDpjb2x1bW5BbGxvd0RhdGEoKTpyZWFkeUFyZ3VtZW50SW5zZXJ0KCk7DQogICAgbG9jYWwgcXVlcnlTdHJpbmcgPSAiaW5zZXJ0IGludG8gIi4udGFibGVJbnNlcnQucHJlZml4Li4iXyIuLnRhYmxlSW5zZXJ0Lm5hbWUgLi4iICgiIC4uIHRhYmxlSW5zZXJ0LmNvbHVtbnNJbnNlcnQgLi4gIikgdmFsdWVzICgiIC4uIHRhYmxlSW5zZXJ0LmRhdGFJbnNlcnQgIC4uIikiDQogICAgbG9jYWwgdGFibGVEYXRhID0gew0KICAgICAgICBxdWVyeT0gcXVlcnlTdHJpbmcgLA0KICAgICAgICBwYXJhbXMgPSB0YWJsZUluc2VydC5wYXJhbXMNCiAgICB9Ow0KICAgIGRiLnN0YXJ0KCk7DQogICAgZGIudXNlX2RiKF9DT1NUX0RCX0JPVCkNCiAgICBkYi5xdWVyeV9pbW1lZGlhdGUodGFibGVEYXRhKTsNCiAgICBkYi5jb21taXQoKTsNCiAgICBkYi51c2VfZGIoX0NPU1RfREJfTUFJTikNCmVuZA0KDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLS0gZGVsZXRlIFRhYmxlDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KdGFibGVEZWxldGUgPSB7fTsNCmZ1bmN0aW9uIHRhYmxlRGVsZXRlOmluaXQocHJlZml4ICwgbmFtZSAsIHdoZXJlICwgcGFyYW1zKQ0KICAgIHNlbGYucHJlZml4ID0gcHJlZml4Ow0KICAgIHNlbGYubmFtZSA9IG5hbWU7DQogICAgc2VsZi53aGVyZSA9IHdoZXJlOw0KICAgIHNlbGYucGFyYW1zID0gcGFyYW1zOw0KICAgIC0tLQ0KICAgIHJldHVybiBzZWxmDQplbmQNCmZ1bmN0aW9uIHRhYmxlRGVsZXRlLnJ1bigpDQogICAgbG9jYWwgcXVlcnlTdHJpbmcgPSAiZGVsZXRlIGZyb20gIi4udGFibGVEZWxldGUucHJlZml4Li4iXyIuLnRhYmxlRGVsZXRlLm5hbWUgLi4iICIgLi4gdGFibGVEZWxldGUud2hlcmU7DQogICAgbG9jYWwgdGFibGVEYXRhID0gew0KICAgICAgICBxdWVyeT0gcXVlcnlTdHJpbmcgLA0KICAgICAgICBwYXJhbXMgPSB0YWJsZURlbGV0ZS5wYXJhbXMNCiAgICB9Ow0KICAgIGRiLnN0YXJ0KCk7DQogICAgZGIudXNlX2RiKF9DT1NUX0RCX0JPVCkNCiAgICBkYi5xdWVyeV9pbW1lZGlhdGUodGFibGVEYXRhKTsNCiAgICBkYi5jb21taXQoKTsNCiAgICBkYi51c2VfZGIoX0NPU1RfREJfTUFJTikNCmVuZA0KDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLS0gdXBkYXRlIFRhYmxlDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KdGFibGVVcGRhdGUgPSB7fTsNCmZ1bmN0aW9uIHRhYmxlVXBkYXRlOmluaXQocHJlZml4ICwgbmFtZSAsIGNvbHVtbnMgLCB3aGVyZSAsIHBhcmFtcyAsIGRhdGEpDQogICAgc2VsZi5wcmVmaXggPSBwcmVmaXg7DQogICAgc2VsZi5uYW1lID0gbmFtZTsNCiAgICBzZWxmLmNvbHVtbnMgPSBjb2x1bW5zOw0KICAgIHNlbGYud2hlcmUgPSB3aGVyZTsNCiAgICBzZWxmLnBhcmFtcyA9IHBhcmFtczsNCiAgICBzZWxmLmRhdGEgPSBkYXRhOw0KICAgIC0tLQ0KICAgIHNlbGYuYWxsb3dEYXRhID0ge307DQogICAgc2VsZi5jb2x1bW5zVXBkYXRlPSIiOw0KICAgIHNlbGYucmVzdWx0UGFyYW1zPSB7fTsNCiAgICByZXR1cm4gc2VsZg0KZW5kDQpmdW5jdGlvbiB0YWJsZVVwZGF0ZTpjb2x1bW5BbGxvd0RhdGEoKQ0KICAgIGZvciBpID0gMSAsICN0YWJsZVVwZGF0ZS5kYXRhICwgMSAgIGRvDQogICAgICAgIGxvY2FsIGl0ZW1EYXRhID0gdGFibGVVcGRhdGUuZGF0YVtpXTsNCiAgICAgICAgbG9jYWwgZXhpc3REYXRhID0gZmFsc2U7DQogICAgICAgIGlmIGlzc2V0S2V5KGl0ZW1EYXRhICwgImNvbHVtbiIpIGFuZCAgaXNzZXRLZXkoaXRlbURhdGEgLCAidmFsdWUiKSB0aGVuDQogICAgICAgICAgICBmb3IgeCA9IDEgLCAjdGFibGVVcGRhdGUuY29sdW1ucyAsIDEgICBkbw0KICAgICAgICAgICAgICAgIGxvY2FsIGl0ZW1Db2x1bW4gPSB0YWJsZVVwZGF0ZS5jb2x1bW5zW3hdOw0KICAgICAgICAgICAgICAgIGlmIGlzc2V0S2V5KGl0ZW1Db2x1bW4gLCAiY29sdW1uIikgYW5kIGl0ZW1EYXRhLmNvbHVtbiA9PSBpdGVtQ29sdW1uLmNvbHVtbiAgdGhlbg0KICAgICAgICAgICAgICAgICAgICBleGlzdERhdGEgPXRydWU7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIGlmIGV4aXN0RGF0YSB0aGVuDQogICAgICAgICAgICB0YWJsZS5pbnNlcnQodGFibGVVcGRhdGUuYWxsb3dEYXRhICwgaXRlbURhdGEpDQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBzZWxmOw0KZW5kDQpmdW5jdGlvbiB0YWJsZVVwZGF0ZTpyZWFkeUFyZ3VtZW50VXBkYXRlKCkNCg0KICAgIGZvciBpID0gMSAsICN0YWJsZVVwZGF0ZS5hbGxvd0RhdGEgLCAxICAgZG8NCiAgICAgICAgbG9jYWwgaXRlbURhdGEgPSB0YWJsZVVwZGF0ZS5hbGxvd0RhdGFbaV07DQogICAgICAgIHRhYmxlVXBkYXRlLmNvbHVtbnNVcGRhdGUgPSB0YWJsZVVwZGF0ZS5jb2x1bW5zVXBkYXRlIC4uIGl0ZW1EYXRhLmNvbHVtbiAuLiAiPT8gIiA7DQogICAgICAgIHRhYmxlLmluc2VydCh0YWJsZVVwZGF0ZS5yZXN1bHRQYXJhbXMgLCBpdGVtRGF0YS52YWx1ZSkNCiAgICAgICAgaWYgaSA8ICN0YWJsZVVwZGF0ZS5hbGxvd0RhdGEgdGhlbg0KICAgICAgICAgICAgdGFibGVVcGRhdGUuY29sdW1uc1VwZGF0ZSA9IHRhYmxlVXBkYXRlLmNvbHVtbnNVcGRhdGUgLi4gIiAsICINCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgcmV0dXJuIHNlbGY7DQplbmQNCmZ1bmN0aW9uIHRhYmxlVXBkYXRlLnJ1bigpDQogICAgdGFibGVVcGRhdGU6Y29sdW1uQWxsb3dEYXRhKCk6cmVhZHlBcmd1bWVudFVwZGF0ZSgpOw0KICAgIGxvY2FsIHF1ZXJ5U3RyaW5nID0gInVwZGF0ZSAiLi50YWJsZVVwZGF0ZS5wcmVmaXguLiJfIi4udGFibGVVcGRhdGUubmFtZSAuLiIgc2V0ICIgLi4gdGFibGVVcGRhdGUuY29sdW1uc1VwZGF0ZSAuLiAiICIgLi4gdGFibGVVcGRhdGUud2hlcmU7DQogICAgZm9yIGkgPSAxICwgI3RhYmxlVXBkYXRlLnBhcmFtcyAsIDEgICBkbw0KICAgICAgICBsb2NhbCBpdGVtUGFyYW1zID0gdGFibGVVcGRhdGUucGFyYW1zW2ldOw0KICAgICAgICB0YWJsZS5pbnNlcnQodGFibGVVcGRhdGUucmVzdWx0UGFyYW1zICwgaXRlbVBhcmFtcykNCiAgICBlbmQNCiAgICBsb2NhbCB0YWJsZURhdGEgPSB7DQogICAgICAgIHF1ZXJ5PSBxdWVyeVN0cmluZyAsDQogICAgICAgIHBhcmFtcyA9IHRhYmxlVXBkYXRlLnJlc3VsdFBhcmFtcw0KICAgIH07DQoNCiAgICBkYi5zdGFydCgpOw0KICAgIGRiLnVzZV9kYihfQ09TVF9EQl9CT1QpDQogICAgZGIucXVlcnlfaW1tZWRpYXRlKHRhYmxlRGF0YSk7DQogICAgZGIuY29tbWl0KCk7DQplbmQNCg0KcmV0dXJuIHRhYmxlRGF0YTs=","mime":"text/plain","name":"Database_FromWork.lua"}],"bytecode_command":"","command":"-- botName = status_todo_step_boty\r\n-- creator = mehdi-marefiyan\r\n-- date = 7/17/2024\r\n-- version= 0.1\r\n------------------\r\nlocal defaultStaustRunBots = true;\r\n\r\n\r\n_boxAttachment = {\r\n    attachments = {}\r\n};\r\nfunction _boxAttachment.getAttachment(fileName , isTable)\r\n    for key, code in pairs(_boxAttachment.attachments) do\r\n        if key == fileName then\r\n            return code;\r\n        end\r\n    end\r\n\r\n    local configJson = teamyar.get_attachment(fileName);\r\n    if configJson~= nil then\r\n        local result = configJson;\r\n        if isTable ~= nil and isTable == true then\r\n            result = json.decode(configJson);\r\n        end\r\n        _boxAttachment.attachments[fileName] = result;\r\n        return result;\r\n    end\r\n\r\n    return nil;\r\nend\r\n\r\n\r\n_render = {};\r\nfunction _render:init(files)\r\n    _render.files = files;\r\n    _render.libs = {};\r\n    return self;\r\nend\r\nfunction _render:renderFile(code)\r\n    if type(code) == \"table\" then\r\n        if code.file ~= nil then\r\n            code = code.file;\r\n        end\r\n    end\r\n    code = _boxAttachment.getAttachment(code);\r\n    local loadedFunction, errorMessage = load(code)\r\n    if loadedFunction then\r\n        local result = loadedFunction();\r\n        if result ~= nil then\r\n            table.insert(_render.libs , result);\r\n        end\r\n    else\r\n        teamyar.write_log(\"Error: \" .. errorMessage);\r\n    end\r\n    return self;\r\nend\r\nfunction _render.run()\r\n    for x = 1 , #_render.files , 1   do\r\n        local item = _render.files[x];\r\n        if item ~= nil then\r\n            _render:renderFile(item);\r\n        end\r\n    end\r\n    return _render.libs;\r\nend\r\n\r\n\r\n\r\n----------------\r\nlocal request_products = {};\r\nfunction request_products:init()\r\n    self.config = {};\r\n    self.requires = {};\r\n    self.libs = {};\r\n    ---\r\n    self.task_id = nil;\r\n    self.task_step_id = nil;\r\n    ---\r\n    self.step_data = nil;\r\n    return self;\r\nend\r\nfunction request_products:getConfig()\r\n    request_products.config = _boxAttachment.getAttachment(\"config.json\" , true);\r\n    return self;\r\nend\r\nfunction request_products:getRequires()\r\n    if request_products.config ~= nil and  request_products.config.requires ~= nil then\r\n        request_products.requires = request_products.config.requires;\r\n    end\r\n    return self;\r\nend\r\n\r\nfunction request_products:setLibraries()\r\n    request_products.libs = _render:init(request_products.requires).run();\r\n    return self;\r\nend\r\nfunction request_products:getParams()\r\n    setParamToObject(request_products ,'task_id' , \"number\" , 0);\r\n    setParamToObject(request_products ,'task_step_id' , \"number\" , 0);\r\n    return self;\r\nend\r\nfunction request_products:runQueryTask()\r\n\r\n    local query = _boxAttachment.getAttachment(\"query_get_data_step.txt\");\r\n    local params = {};\r\n\r\n    query , params = whereQuery:init()\r\n            :addSqlWhere( tonumber(request_products.task_id ), \"id=?\" , false)\r\n            .run(query , params ,\"{{whereTask}}\");\r\n\r\n    query , params = whereQuery:init()\r\n            :addSqlWhere( tonumber(request_products.task_step_id ), \"tts.id=?\" , false)\r\n            .run(query , params ,\"{{whereTaskStep}}\");\r\n\r\n    request_products.step_data  = baseQuery:init()\r\n            :setQuery(query)\r\n            :setFirst(1)\r\n            :setSelects({ column= 'step_rel_status' , alias= 'step_rel_status' })\r\n            :setParams(params)\r\n            .fetch();\r\n  \r\n  teamyar.write_log(query);\r\n  teamyar.write_log(json.encode(params));\r\n  teamyar.write_log(json.encode(request_products.step_data ));\r\n  \r\n    return self;\r\nend\r\nfunction request_products.returnStatusCheck()\r\n    local resultExp = {\r\n        status = defaultStaustRunBots ,\r\n        msg = language_tools.translateWord(\"_msg_null_status\" , \"\")\r\n    }\r\n\r\n    if request_products.step_data~= nil and request_products.step_data.step_rel_status~=nil then\r\n        local status = request_products.step_data.step_rel_status;\r\n        if status == 1 then\r\n            resultExp.status = false;\r\n            resultExp.msg = language_tools.translateWord(\"_msg_true_status\" , \"\");\r\n        else\r\n            resultExp.status = true;\r\n            resultExp.msg = language_tools.translateWord(\"_msg_false_status\" , \"\");\r\n        end\r\n    end\r\n    teamyar.write_log(json.encode(resultExp));\r\n    return bot_coding.jsonCodding(resultExp);\r\nend\r\n\r\nfunction request_products.run()\r\n    request_products:getConfig():getRequires():setLibraries():getParams():runQueryTask();\r\n    return request_products.returnStatusCheck();\r\nend\r\n\r\nteamyar.write_result(request_products:init().run())","form_setting":"{\"layout\":{\"width_title\":3,\"col\":\"COL-2\",\"seperator\":\"\"},\"info\":[],\"schema\":{},\"default_value\":{}}","info":{"async_deadline_run":0,"async_run":0,"cache_time":0,"color":"","db_prefix":"","description":"","domain":"test.tsco.ir","icon":"","id":424,"license_id":0,"max_execute_time":100,"modify_date":133659533875189053,"name":"بات بررسی وضعیت مرحله باتی اقدام","not_showing_in_iframe":1,"open_source":1,"public_access":1,"relateds":[],"result_type":1,"run_path":"332/status_todo_step_boty","show_in_portal_menu":1,"show_in_widget":1,"subsystem":[]}}